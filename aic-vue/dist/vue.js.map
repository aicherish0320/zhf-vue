{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["export function isFunction(data) {\r\n  return typeof data === 'function'\r\n}\r\n\r\nexport function isObject(val) {\r\n  return typeof val === 'object' && val !== null\r\n}\r\n\r\nexport function isArray(val) {\r\n  return Array.isArray(val)\r\n}\r\n","// 获取数组的老的原型方法\r\nconst oldArrayPrototype = Array.prototype\r\n// 让 arrayMethods 通过 __proto__ 能获取到数组的方法\r\nexport const arrayMethods = Object.create(oldArrayPrototype)\r\n// 只有这7个方法可以导致数组发生变化\r\nconst methods = ['push', 'pop', 'unshift', 'reverse', 'sort', 'splice', 'shift']\r\n\r\nmethods.forEach((method) => {\r\n  // 属性的查找，是先找自己身上的，找不到去原型上查找\r\n  arrayMethods[method] = function () {\r\n    console.log('数组的方法进行重写操作')\r\n  }\r\n})\r\n","import { isArray, isObject } from '../utils'\r\nimport { arrayMethods } from './array'\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    if (isArray(value)) {\r\n      // 更改数组原型方法\r\n      value.__proto__ = arrayMethods\r\n    } else {\r\n      // 核心就是循环对象\r\n      this.walk(value)\r\n    }\r\n  }\r\n\r\n  walk(data) {\r\n    Object.keys(data).forEach((key) => {\r\n      // 要是用 defineProperty 重新定义\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\n/*\r\n  性能优化的原则\r\n    1. 不要把所有的数据都放在 data 中\r\n    2. 不要写数据的时候，层次过深；尽量扁平化数据\r\n    3. 不要频繁获取数据\r\n    4. 数据不需要响应式，可以使用 Object.freeze 冻结属性\r\n*/\r\nfunction defineReactive(obj, key, value) {\r\n  observe(value)\r\n  Object.defineProperty(obj, key, {\r\n    get() {\r\n      // 闭包，value 会向上层查找\r\n      return value\r\n    },\r\n    set(newVal) {\r\n      if (value !== newVal) {\r\n        value = newVal\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe(value) {\r\n  // 如果 value 不是对象，那么就不用观察了\r\n  if (!isObject(value)) {\r\n    return\r\n  }\r\n\r\n  // 需要对对象进行观测 （最外层必须是一个 {}， 不能是数组）\r\n  // 如果一个数据已经被观测过了，就不要再进行观测了，用类来实现，观测过了就增加一个标识\r\n  // 在观测的时候，可以先检测是否观测过了，如果观测过了就跳过检测\r\n  return new Observer(value)\r\n}\r\n","import { observe } from './observe'\r\nimport { isFunction } from './utils'\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n}\r\n\r\nfunction initData(vm) {\r\n  // 用户传入的数据\r\n  let data = vm.$options.data\r\n  // 如果用户传递的是一个函数 则取函数的返回值作为data\r\n  // 只有根实例的data可以一个对象\r\n  // 需要将 data 变成响应式的 `Object.defineProperty`，重写 `data` 中的所有属性\r\n  vm._data = data = isFunction(data) ? data.call(vm) : data\r\n\r\n  observe(data)\r\n\r\n  for (const key in data) {\r\n    proxy(vm, key, '_data')\r\n  }\r\n}\r\n// 将数据代理带 vm 上\r\nfunction proxy(vm, key, source) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key]\r\n    },\r\n    set(newVal) {\r\n      if (newVal !== value) {\r\n        vm[source][key] = newVal\r\n      }\r\n    }\r\n  })\r\n}\r\n","import { initState } from './state'\r\n\r\nexport function initMixin(Vue) {\r\n  // 后续组件化开发的时候 Vue.extend 可以创造一个子组件，子组件可以继承 Vue，子组件也可以调用\r\n  // _init 方法\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this\r\n    // 把用户的选项放到 vm 上，这样在其他方法中都可以获取到 options\r\n    // 为了后续扩展的方法，都可以获取 $options 选项\r\n    vm.$options = options\r\n\r\n    initState(vm)\r\n\r\n    if (vm.$options.el) {\r\n      // 要将数据挂载到页面上\r\n    }\r\n  }\r\n}\r\n","import { initMixin } from './init'\r\n\r\n/*\r\n  Vue 通过原型的模式来实现扩展的\r\n*/\r\nfunction Vue(options) {\r\n  // 实现 Vue 的初始化功能\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue\r\n"],"names":["isFunction","data","isObject","val","isArray","Array","oldArrayPrototype","prototype","arrayMethods","Object","create","methods","forEach","method","console","log","Observer","constructor","value","__proto__","walk","keys","key","defineReactive","obj","observe","defineProperty","get","set","newVal","initState","vm","opts","$options","initData","_data","call","proxy","source","initMixin","Vue","_init","options","el"],"mappings":"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"}
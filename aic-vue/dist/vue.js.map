{"version":3,"file":"vue.js","sources":["../src/compiler/parser.js","../src/compiler/index.js","../src/utils.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["export function parseHTML(html) {\r\n  // 正则\r\n  const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*` // 匹配标签名\r\n  const qnameCapture = `((?:${ncname}\\\\:)?${ncname})`\r\n  const startTagOpen = new RegExp(`^<${qnameCapture}`) // 匹配标签名\r\n  const endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`) // 匹配标签结束 </aa>\r\n  const attribute =\r\n    /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/ // 匹配属性\r\n  const startTagClose = /^\\s*(\\/?)>/ // 匹配结束标签 > />\r\n  // 构建父子关系\r\n  let stack = []\r\n  let root = null\r\n\r\n  function createASTElement(tag, attrs, parent = null) {\r\n    return {\r\n      tag,\r\n      type: 1,\r\n      children: [],\r\n      parent,\r\n      attrs\r\n    }\r\n  }\r\n  function start(tag, attrs) {\r\n    // 遇到开始标签，就取栈中的最后一个 作为父级\r\n    const parent = stack[stack.length - 1]\r\n    let element = createASTElement(tag, attrs, parent)\r\n    // 说明当前节点就是根节点\r\n    if (root === null) {\r\n      root = element\r\n    }\r\n    if (parent) {\r\n      // 更新父级节点\r\n      element.parent = parent\r\n      parent.children.push(element)\r\n    }\r\n\r\n    stack.push(element)\r\n  }\r\n  function end(tag) {\r\n    const endTag = stack.pop()\r\n    if (endTag.tag !== tag) {\r\n      console.log('标签出错了')\r\n    }\r\n  }\r\n  function text(chars) {\r\n    const parent = stack[stack.length - 1]\r\n    chars.replace(/\\s/g, '')\r\n    if (chars) {\r\n      parent.children.push({\r\n        type: 2,\r\n        text: chars\r\n      })\r\n    }\r\n  }\r\n\r\n  function advance(len) {\r\n    html = html.substring(len)\r\n  }\r\n\r\n  function parseStartTag() {\r\n    const startMatch = html.match(startTagOpen)\r\n    if (startMatch) {\r\n      const match = {\r\n        tagName: startMatch[1],\r\n        attrs: []\r\n      }\r\n      advance(startMatch[0].length)\r\n      // 匹配属性 1. 要有属性，2.不能为开始的结束标签\r\n      let end, attr\r\n      while (\r\n        !(end = html.match(startTagClose)) &&\r\n        (attr = html.match(attribute))\r\n      ) {\r\n        match.attrs.push({\r\n          name: attr[1],\r\n          value: attr[3] || attr[4] || attr[5]\r\n        })\r\n        advance(attr[0].length)\r\n      }\r\n      if (end) {\r\n        advance(end[0].length)\r\n      }\r\n      return match\r\n    }\r\n    return false\r\n  }\r\n\r\n  // 不停的截取模板，直到把模板全部解析完毕\r\n  while (html) {\r\n    // 解析 标签和文本\r\n    let index = html.indexOf('<')\r\n    if (index === 0) {\r\n      // 标签 解析开始标签 并且把属性也解析出来\r\n      const startTagMatch = parseStartTag()\r\n\r\n      if (startTagMatch) {\r\n        // 开始标签\r\n        start(startTagMatch.tagName, startTagMatch.attrs)\r\n        continue\r\n      }\r\n      let endTagMatch\r\n      if ((endTagMatch = html.match(endTag))) {\r\n        // 结束标签\r\n        end(endTagMatch[1])\r\n        advance(endTagMatch[0].length)\r\n        continue\r\n      }\r\n\r\n      break\r\n    }\r\n    // 文本\r\n    if (index > 0) {\r\n      let chars = html.substring(0, index)\r\n      text(chars)\r\n      advance(chars.length)\r\n    }\r\n  }\r\n  return root\r\n}\r\n","import { parseHTML } from './parser'\r\n\r\nexport function compileToFunction(template) {\r\n  // 1. 将模板编程 ast 语法树\r\n  const ast = parseHTML(template)\r\n  // 2. 代码优化 编辑静态节点\r\n  // 3. 代码生成\r\n  const code = generate(ast)\r\n  const render = new Function(`with(this){${code}}`)\r\n  console.log('code >>> ', render.toString(), code)\r\n}\r\n\r\nfunction genProps(attrs) {\r\n  let str = ''\r\n  // { key: value, key: value }\r\n  for (let i = 0; i < attrs.length; i++) {\r\n    let attr = attrs[i]\r\n\r\n    if (attr.name === 'style') {\r\n      let styles = {}\r\n      attr.value.replace(/([^;:]+):([^;:]+)/g, function () {\r\n        styles[arguments[1].trim()] = arguments[2].trim()\r\n      })\r\n      attr.value = styles\r\n    }\r\n\r\n    str += `${attr.name}:${JSON.stringify(attr.value)},`\r\n  }\r\n  return `{${str.slice(0, -1)}}`\r\n}\r\n\r\nfunction gen(el) {\r\n  const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\r\n  if (el.type === 1) {\r\n    // 如果是元素就递归生成\r\n    return generate(el)\r\n  } else {\r\n    let text = el.text\r\n    // 说明是普通文本\r\n    if (!defaultTagRE.test(text)) {\r\n      return `_v('${text}')`\r\n    }\r\n    // <div>aa {{ name }} bb</div>\r\n    // 说明有表达式。需要做一个表达式和普通值的拼接 _v('aaa', _s(name), 'bbb')\r\n    let lastIndex = (defaultTagRE.lastIndex = 0)\r\n    let tokens = []\r\n    let match\r\n    // 如果正则 + g，lastIndex\r\n    while ((match = defaultTagRE.exec(text))) {\r\n      let index = match.index\r\n      if (index > lastIndex) {\r\n        tokens.push(JSON.stringify(text.slice(lastIndex, index)))\r\n      }\r\n      tokens.push(`_s(${match[1].trim()})`)\r\n      lastIndex = index + match[0].length\r\n    }\r\n\r\n    if (lastIndex < text.length) {\r\n      tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n    }\r\n\r\n    return `_v(${tokens.join('+')})`\r\n  }\r\n}\r\n\r\nfunction genChildren(el) {\r\n  let children = el.children\r\n  if (children) {\r\n    return children.map((item) => gen(item)).join(',')\r\n  }\r\n  return false\r\n}\r\n\r\nfunction generate(ast) {\r\n  let children = genChildren(ast)\r\n  let code = `_c('${ast.tag}', ${\r\n    ast.attrs.length ? genProps(ast.attrs) : undefined\r\n  }${children ? `,${children}` : ''})`\r\n\r\n  return code\r\n}\r\n","export function isFunction(data) {\r\n  return typeof data === 'function'\r\n}\r\n\r\nexport function isObject(val) {\r\n  return typeof val === 'object' && val !== null\r\n}\r\n\r\nexport function isArray(val) {\r\n  return Array.isArray(val)\r\n}\r\n","// 获取数组的老的原型方法\r\nconst oldArrayPrototype = Array.prototype\r\n// 让 arrayMethods 通过 __proto__ 能获取到数组的方法\r\nexport const arrayMethods = Object.create(oldArrayPrototype)\r\n// 只有这7个方法可以导致数组发生变化\r\nconst methods = ['push', 'pop', 'unshift', 'reverse', 'sort', 'splice', 'shift']\r\n\r\nmethods.forEach((method) => {\r\n  // 属性的查找，是先找自己身上的，找不到去原型上查找\r\n  arrayMethods[method] = function (...args) {\r\n    // 数组新增的属性 要看一下是不是对象 如果是对象 则继续进行劫持\r\n    // 需要调用数组原生逻辑\r\n    oldArrayPrototype[method].call(this, ...args)\r\n    // TODO... 可以添加自己的逻辑 函数劫持 切片\r\n    let inserted = null\r\n    let ob = this.__ob__\r\n    switch (method) {\r\n      // 修改 删除 添加\r\n      case 'splice':\r\n        inserted = args.slice(2) // splice 方法从第三个参数起 是添加的新数据\r\n        break\r\n      case 'push':\r\n      case 'unshift':\r\n        // 调用 push/unshift 传递的参数就是新增的逻辑\r\n        inserted = args\r\n        break\r\n    }\r\n    // inserted 遍历数组，看一个它是否需要进行再次劫持\r\n    if (inserted) {\r\n      ob.observeArray(inserted)\r\n    }\r\n  }\r\n})\r\n","import { isArray, isObject } from '../utils'\r\nimport { arrayMethods } from './array'\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    // 给对象和数组添加一个自定义属性\r\n    Object.defineProperty(value, '__ob__', {\r\n      enumerable: false,\r\n      value: this\r\n    })\r\n    if (isArray(value)) {\r\n      // 更改数组原型方法\r\n      value.__proto__ = arrayMethods\r\n      this.observeArray(value)\r\n    } else {\r\n      // 核心就是循环对象\r\n      this.walk(value)\r\n    }\r\n  }\r\n  // 递归遍历数组，对数组内部的对象再次重写\r\n  observeArray(data) {\r\n    // 数组里面如果是引用类型那么是响应式的\r\n    data.forEach((item) => observe(item))\r\n  }\r\n\r\n  walk(data) {\r\n    Object.keys(data).forEach((key) => {\r\n      // 使用 defineProperty 重新定义\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\n/*\r\n  性能优化的原则\r\n    1. 不要把所有的数据都放在 data 中\r\n    2. 不要写数据的时候，层次过深；尽量扁平化数据\r\n    3. 不要频繁获取数据\r\n    4. 数据不需要响应式，可以使用 Object.freeze 冻结属性\r\n*/\r\nfunction defineReactive(obj, key, value) {\r\n  observe(value)\r\n  Object.defineProperty(obj, key, {\r\n    get() {\r\n      console.log('get >>> ', key, value)\r\n      // 闭包，value 会向上层查找\r\n      return value\r\n    },\r\n    set(newVal) {\r\n      if (value !== newVal) {\r\n        console.log('set >>> ', key, newVal)\r\n        observe(newVal)\r\n        value = newVal\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe(value) {\r\n  // 如果 value 不是对象，那么就不用观察了\r\n  if (!isObject(value)) {\r\n    return\r\n  }\r\n\r\n  // 一个对象不需要重新被观测\r\n  if (value.__ob__) {\r\n    return\r\n  }\r\n\r\n  // 需要对对象进行观测 （最外层必须是一个 {}， 不能是数组）\r\n  // 如果一个数据已经被观测过了，就不要再进行观测了，用类来实现，观测过了就增加一个标识\r\n  // 在观测的时候，可以先检测是否观测过了，如果观测过了就跳过检测\r\n  return new Observer(value)\r\n}\r\n","import { observe } from './observe'\r\nimport { isFunction } from './utils'\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n}\r\n\r\nfunction initData(vm) {\r\n  // 用户传入的数据\r\n  let data = vm.$options.data\r\n  // 如果用户传递的是一个函数 则取函数的返回值作为data\r\n  // 只有根实例的data可以一个对象\r\n  // 需要将 data 变成响应式的 `Object.defineProperty`，重写 `data` 中的所有属性\r\n  vm._data = data = isFunction(data) ? data.call(vm) : data\r\n\r\n  observe(data)\r\n\r\n  for (const key in data) {\r\n    proxy(vm, key, '_data')\r\n  }\r\n}\r\n// 将数据代理带 vm 上\r\n// 取值的时候做代理，不是暴力的把 _data 属性赋予给 vm，而且直接赋值会有命名冲突问题\r\nfunction proxy(vm, key, source) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key]\r\n    },\r\n    set(newVal) {\r\n      vm[source][key] = newVal\r\n    }\r\n  })\r\n}\r\n","import { compileToFunction } from './compiler'\r\nimport { initState } from './state'\r\n\r\nexport function initMixin(Vue) {\r\n  // 后续组件化开发的时候 Vue.extend 可以创造一个子组件，子组件可以继承 Vue，子组件也可以调用\r\n  // _init 方法\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this\r\n    // 把用户的选项放到 vm 上，这样在其他方法中都可以获取到 options\r\n    // 为了后续扩展的方法，都可以获取 $options 选项\r\n    vm.$options = options\r\n\r\n    initState(vm)\r\n\r\n    if (vm.$options.el) {\r\n      // 要将数据挂载到页面上\r\n      // 数据变化需要更新视图，diff 算法更新需要更新的部分\r\n      // vue -> template（写起来更方便）\r\n      // vue3 -> template 写起来性能会更高，内部做了很多优化\r\n      // template -> ast 语法树（用来描述语法的，虚拟 DOM 描述 DOM 节点）-> 描述成一个树结构 -> 将代码重组成 JS 语法\r\n      // 模板编译原理：把template模板编译成 render 函数，render 函数返回 虚拟DOM -> diff 算法对比虚拟DOM\r\n      // ast -> render -> vNode -> 真实DOM\r\n      // 更新的时候 再次调用 render 生成新的vNode -> 新旧比对 -> 更新真实DOM\r\n      vm.$mount(vm.$options.el)\r\n    }\r\n  }\r\n  Vue.prototype.$mount = function (el) {\r\n    const vm = this\r\n    const opts = vm.$options\r\n    // 获取真实的元素\r\n    el = document.querySelector(el)\r\n    // 页面真实元素\r\n    vm.$el = el\r\n\r\n    if (!opts.render) {\r\n      // 模板编译\r\n      let template = opts.template\r\n      if (!template) {\r\n        template = el.outerHTML\r\n      }\r\n\r\n      let render = compileToFunction(template)\r\n      opts.render = render\r\n    }\r\n\r\n    // console.log('render >>> ', opts.render)\r\n  }\r\n}\r\n","import { initMixin } from './init'\r\n\r\n/*\r\n  Vue 通过原型的模式来实现扩展的\r\n*/\r\nfunction Vue(options) {\r\n  // 实现 Vue 的初始化功能\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\n\r\nexport default Vue\r\n"],"names":["parseHTML","html","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","stack","root","createASTElement","tag","attrs","parent","type","children","start","length","element","push","end","pop","console","log","text","chars","replace","advance","len","substring","parseStartTag","startMatch","match","tagName","attr","name","value","index","indexOf","startTagMatch","endTagMatch","compileToFunction","template","ast","code","generate","render","Function","toString","genProps","str","i","styles","arguments","trim","JSON","stringify","slice","gen","el","defaultTagRE","test","lastIndex","tokens","exec","join","genChildren","map","item","undefined","isFunction","data","isObject","val","isArray","Array","oldArrayPrototype","prototype","arrayMethods","Object","create","methods","forEach","method","args","call","inserted","ob","__ob__","observeArray","Observer","constructor","defineProperty","enumerable","__proto__","walk","observe","keys","key","defineReactive","obj","get","set","newVal","initState","vm","opts","$options","initData","_data","proxy","source","initMixin","Vue","_init","options","$mount","document","querySelector","$el","outerHTML"],"mappings":";;;;;;EAAO,SAASA,SAAT,CAAmBC,IAAnB,EAAyB;EAC9B;EACA,QAAMC,MAAM,GAAI,8BAAhB,CAF8B;;EAG9B,QAAMC,YAAY,GAAI,OAAMD,MAAO,QAAOA,MAAO,GAAjD;EACA,QAAME,YAAY,GAAG,IAAIC,MAAJ,CAAY,KAAIF,YAAa,EAA7B,CAArB,CAJ8B;;EAK9B,QAAMG,MAAM,GAAG,IAAID,MAAJ,CAAY,QAAOF,YAAa,QAAhC,CAAf,CAL8B;;EAM9B,QAAMI,SAAS,GACb,2EADF,CAN8B;;EAQ9B,QAAMC,aAAa,GAAG,YAAtB,CAR8B;EAS9B;;EACA,MAAIC,KAAK,GAAG,EAAZ;EACA,MAAIC,IAAI,GAAG,IAAX;;EAEA,WAASC,gBAAT,CAA0BC,GAA1B,EAA+BC,KAA/B,EAAsCC,MAAM,GAAG,IAA/C,EAAqD;EACnD,WAAO;EACLF,MAAAA,GADK;EAELG,MAAAA,IAAI,EAAE,CAFD;EAGLC,MAAAA,QAAQ,EAAE,EAHL;EAILF,MAAAA,MAJK;EAKLD,MAAAA;EALK,KAAP;EAOD;;EACD,WAASI,KAAT,CAAeL,GAAf,EAAoBC,KAApB,EAA2B;EACzB;EACA,UAAMC,MAAM,GAAGL,KAAK,CAACA,KAAK,CAACS,MAAN,GAAe,CAAhB,CAApB;EACA,QAAIC,OAAO,GAAGR,gBAAgB,CAACC,GAAD,EAAMC,KAAN,EAAaC,MAAb,CAA9B,CAHyB;;EAKzB,QAAIJ,IAAI,KAAK,IAAb,EAAmB;EACjBA,MAAAA,IAAI,GAAGS,OAAP;EACD;;EACD,QAAIL,MAAJ,EAAY;EACV;EACAK,MAAAA,OAAO,CAACL,MAAR,GAAiBA,MAAjB;EACAA,MAAAA,MAAM,CAACE,QAAP,CAAgBI,IAAhB,CAAqBD,OAArB;EACD;;EAEDV,IAAAA,KAAK,CAACW,IAAN,CAAWD,OAAX;EACD;;EACD,WAASE,GAAT,CAAaT,GAAb,EAAkB;EAChB,UAAMN,MAAM,GAAGG,KAAK,CAACa,GAAN,EAAf;;EACA,QAAIhB,MAAM,CAACM,GAAP,KAAeA,GAAnB,EAAwB;EACtBW,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;EACD;EACF;;EACD,WAASC,IAAT,CAAcC,KAAd,EAAqB;EACnB,UAAMZ,MAAM,GAAGL,KAAK,CAACA,KAAK,CAACS,MAAN,GAAe,CAAhB,CAApB;EACAQ,IAAAA,KAAK,CAACC,OAAN,CAAc,KAAd,EAAqB,EAArB;;EACA,QAAID,KAAJ,EAAW;EACTZ,MAAAA,MAAM,CAACE,QAAP,CAAgBI,IAAhB,CAAqB;EACnBL,QAAAA,IAAI,EAAE,CADa;EAEnBU,QAAAA,IAAI,EAAEC;EAFa,OAArB;EAID;EACF;;EAED,WAASE,OAAT,CAAiBC,GAAjB,EAAsB;EACpB5B,IAAAA,IAAI,GAAGA,IAAI,CAAC6B,SAAL,CAAeD,GAAf,CAAP;EACD;;EAED,WAASE,aAAT,GAAyB;EACvB,UAAMC,UAAU,GAAG/B,IAAI,CAACgC,KAAL,CAAW7B,YAAX,CAAnB;;EACA,QAAI4B,UAAJ,EAAgB;EACd,YAAMC,KAAK,GAAG;EACZC,QAAAA,OAAO,EAAEF,UAAU,CAAC,CAAD,CADP;EAEZnB,QAAAA,KAAK,EAAE;EAFK,OAAd;EAIAe,MAAAA,OAAO,CAACI,UAAU,CAAC,CAAD,CAAV,CAAcd,MAAf,CAAP,CALc;;EAOd,UAAIG,GAAJ,EAASc,IAAT;;EACA,aACE,EAAEd,GAAG,GAAGpB,IAAI,CAACgC,KAAL,CAAWzB,aAAX,CAAR,MACC2B,IAAI,GAAGlC,IAAI,CAACgC,KAAL,CAAW1B,SAAX,CADR,CADF,EAGE;EACA0B,QAAAA,KAAK,CAACpB,KAAN,CAAYO,IAAZ,CAAiB;EACfgB,UAAAA,IAAI,EAAED,IAAI,CAAC,CAAD,CADK;EAEfE,UAAAA,KAAK,EAAEF,IAAI,CAAC,CAAD,CAAJ,IAAWA,IAAI,CAAC,CAAD,CAAf,IAAsBA,IAAI,CAAC,CAAD;EAFlB,SAAjB;EAIAP,QAAAA,OAAO,CAACO,IAAI,CAAC,CAAD,CAAJ,CAAQjB,MAAT,CAAP;EACD;;EACD,UAAIG,GAAJ,EAAS;EACPO,QAAAA,OAAO,CAACP,GAAG,CAAC,CAAD,CAAH,CAAOH,MAAR,CAAP;EACD;;EACD,aAAOe,KAAP;EACD;;EACD,WAAO,KAAP;EACD,GArF6B;;;EAwF9B,SAAOhC,IAAP,EAAa;EACX;EACA,QAAIqC,KAAK,GAAGrC,IAAI,CAACsC,OAAL,CAAa,GAAb,CAAZ;;EACA,QAAID,KAAK,KAAK,CAAd,EAAiB;EACf;EACA,YAAME,aAAa,GAAGT,aAAa,EAAnC;;EAEA,UAAIS,aAAJ,EAAmB;EACjB;EACAvB,QAAAA,KAAK,CAACuB,aAAa,CAACN,OAAf,EAAwBM,aAAa,CAAC3B,KAAtC,CAAL;EACA;EACD;;EACD,UAAI4B,WAAJ;;EACA,UAAKA,WAAW,GAAGxC,IAAI,CAACgC,KAAL,CAAW3B,MAAX,CAAnB,EAAwC;EACtC;EACAe,QAAAA,GAAG,CAACoB,WAAW,CAAC,CAAD,CAAZ,CAAH;EACAb,QAAAA,OAAO,CAACa,WAAW,CAAC,CAAD,CAAX,CAAevB,MAAhB,CAAP;EACA;EACD;;EAED;EACD,KArBU;;;EAuBX,QAAIoB,KAAK,GAAG,CAAZ,EAAe;EACb,UAAIZ,KAAK,GAAGzB,IAAI,CAAC6B,SAAL,CAAe,CAAf,EAAkBQ,KAAlB,CAAZ;EACAb,MAAAA,IAAI,CAACC,KAAD,CAAJ;EACAE,MAAAA,OAAO,CAACF,KAAK,CAACR,MAAP,CAAP;EACD;EACF;;EACD,SAAOR,IAAP;EACD;;ECpHM,SAASgC,iBAAT,CAA2BC,QAA3B,EAAqC;EAC1C;EACA,QAAMC,GAAG,GAAG5C,SAAS,CAAC2C,QAAD,CAArB,CAF0C;EAI1C;;EACA,QAAME,IAAI,GAAGC,QAAQ,CAACF,GAAD,CAArB;EACA,QAAMG,MAAM,GAAG,IAAIC,QAAJ,CAAc,cAAaH,IAAK,GAAhC,CAAf;EACAtB,EAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ,EAAyBuB,MAAM,CAACE,QAAP,EAAzB,EAA4CJ,IAA5C;EACD;;EAED,SAASK,QAAT,CAAkBrC,KAAlB,EAAyB;EACvB,MAAIsC,GAAG,GAAG,EAAV,CADuB;;EAGvB,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGvC,KAAK,CAACK,MAA1B,EAAkCkC,CAAC,EAAnC,EAAuC;EACrC,QAAIjB,IAAI,GAAGtB,KAAK,CAACuC,CAAD,CAAhB;;EAEA,QAAIjB,IAAI,CAACC,IAAL,KAAc,OAAlB,EAA2B;EACzB,UAAIiB,MAAM,GAAG,EAAb;EACAlB,MAAAA,IAAI,CAACE,KAAL,CAAWV,OAAX,CAAmB,oBAAnB,EAAyC,YAAY;EACnD0B,QAAAA,MAAM,CAACC,SAAS,CAAC,CAAD,CAAT,CAAaC,IAAb,EAAD,CAAN,GAA8BD,SAAS,CAAC,CAAD,CAAT,CAAaC,IAAb,EAA9B;EACD,OAFD;EAGApB,MAAAA,IAAI,CAACE,KAAL,GAAagB,MAAb;EACD;;EAEDF,IAAAA,GAAG,IAAK,GAAEhB,IAAI,CAACC,IAAK,IAAGoB,IAAI,CAACC,SAAL,CAAetB,IAAI,CAACE,KAApB,CAA2B,GAAlD;EACD;;EACD,SAAQ,IAAGc,GAAG,CAACO,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAAiB,GAA5B;EACD;;EAED,SAASC,GAAT,CAAaC,EAAb,EAAiB;EACf,QAAMC,YAAY,GAAG,0BAArB;;EACA,MAAID,EAAE,CAAC7C,IAAH,KAAY,CAAhB,EAAmB;EACjB;EACA,WAAO+B,QAAQ,CAACc,EAAD,CAAf;EACD,GAHD,MAGO;EACL,QAAInC,IAAI,GAAGmC,EAAE,CAACnC,IAAd,CADK;;EAGL,QAAI,CAACoC,YAAY,CAACC,IAAb,CAAkBrC,IAAlB,CAAL,EAA8B;EAC5B,aAAQ,OAAMA,IAAK,IAAnB;EACD,KALI;EAOL;;;EACA,QAAIsC,SAAS,GAAIF,YAAY,CAACE,SAAb,GAAyB,CAA1C;EACA,QAAIC,MAAM,GAAG,EAAb;EACA,QAAI/B,KAAJ,CAVK;;EAYL,WAAQA,KAAK,GAAG4B,YAAY,CAACI,IAAb,CAAkBxC,IAAlB,CAAhB,EAA0C;EACxC,UAAIa,KAAK,GAAGL,KAAK,CAACK,KAAlB;;EACA,UAAIA,KAAK,GAAGyB,SAAZ,EAAuB;EACrBC,QAAAA,MAAM,CAAC5C,IAAP,CAAYoC,IAAI,CAACC,SAAL,CAAehC,IAAI,CAACiC,KAAL,CAAWK,SAAX,EAAsBzB,KAAtB,CAAf,CAAZ;EACD;;EACD0B,MAAAA,MAAM,CAAC5C,IAAP,CAAa,MAAKa,KAAK,CAAC,CAAD,CAAL,CAASsB,IAAT,EAAgB,GAAlC;EACAQ,MAAAA,SAAS,GAAGzB,KAAK,GAAGL,KAAK,CAAC,CAAD,CAAL,CAASf,MAA7B;EACD;;EAED,QAAI6C,SAAS,GAAGtC,IAAI,CAACP,MAArB,EAA6B;EAC3B8C,MAAAA,MAAM,CAAC5C,IAAP,CAAYoC,IAAI,CAACC,SAAL,CAAehC,IAAI,CAACiC,KAAL,CAAWK,SAAX,CAAf,CAAZ;EACD;;EAED,WAAQ,MAAKC,MAAM,CAACE,IAAP,CAAY,GAAZ,CAAiB,GAA9B;EACD;EACF;;EAED,SAASC,WAAT,CAAqBP,EAArB,EAAyB;EACvB,MAAI5C,QAAQ,GAAG4C,EAAE,CAAC5C,QAAlB;;EACA,MAAIA,QAAJ,EAAc;EACZ,WAAOA,QAAQ,CAACoD,GAAT,CAAcC,IAAD,IAAUV,GAAG,CAACU,IAAD,CAA1B,EAAkCH,IAAlC,CAAuC,GAAvC,CAAP;EACD;;EACD,SAAO,KAAP;EACD;;EAED,SAASpB,QAAT,CAAkBF,GAAlB,EAAuB;EACrB,MAAI5B,QAAQ,GAAGmD,WAAW,CAACvB,GAAD,CAA1B;EACA,MAAIC,IAAI,GAAI,OAAMD,GAAG,CAAChC,GAAI,MACxBgC,GAAG,CAAC/B,KAAJ,CAAUK,MAAV,GAAmBgC,QAAQ,CAACN,GAAG,CAAC/B,KAAL,CAA3B,GAAyCyD,SAC1C,GAAEtD,QAAQ,GAAI,IAAGA,QAAS,EAAhB,GAAoB,EAAG,GAFlC;EAIA,SAAO6B,IAAP;EACD;;EChFM,SAAS0B,UAAT,CAAoBC,IAApB,EAA0B;EAC/B,SAAO,OAAOA,IAAP,KAAgB,UAAvB;EACD;EAEM,SAASC,QAAT,CAAkBC,GAAlB,EAAuB;EAC5B,SAAO,OAAOA,GAAP,KAAe,QAAf,IAA2BA,GAAG,KAAK,IAA1C;EACD;EAEM,SAASC,OAAT,CAAiBD,GAAjB,EAAsB;EAC3B,SAAOE,KAAK,CAACD,OAAN,CAAcD,GAAd,CAAP;EACD;;ECVD;EACA,MAAMG,iBAAiB,GAAGD,KAAK,CAACE,SAAhC;;EAEO,MAAMC,YAAY,GAAGC,MAAM,CAACC,MAAP,CAAcJ,iBAAd,CAArB;;EAEP,MAAMK,OAAO,GAAG,CAAC,MAAD,EAAS,KAAT,EAAgB,SAAhB,EAA2B,SAA3B,EAAsC,MAAtC,EAA8C,QAA9C,EAAwD,OAAxD,CAAhB;EAEAA,OAAO,CAACC,OAAR,CAAiBC,MAAD,IAAY;EAC1B;EACAL,EAAAA,YAAY,CAACK,MAAD,CAAZ,GAAuB,UAAU,GAAGC,IAAb,EAAmB;EACxC;EACA;EACAR,IAAAA,iBAAiB,CAACO,MAAD,CAAjB,CAA0BE,IAA1B,CAA+B,IAA/B,EAAqC,GAAGD,IAAxC,EAHwC;;EAKxC,QAAIE,QAAQ,GAAG,IAAf;EACA,QAAIC,EAAE,GAAG,KAAKC,MAAd;;EACA,YAAQL,MAAR;EACE;EACA,WAAK,QAAL;EACEG,QAAAA,QAAQ,GAAGF,IAAI,CAAC3B,KAAL,CAAW,CAAX,CAAX,CADF;;EAEE;;EACF,WAAK,MAAL;EACA,WAAK,SAAL;EACE;EACA6B,QAAAA,QAAQ,GAAGF,IAAX;EACA;EATJ,KAPwC;;;EAmBxC,QAAIE,QAAJ,EAAc;EACZC,MAAAA,EAAE,CAACE,YAAH,CAAgBH,QAAhB;EACD;EACF,GAtBD;EAuBD,CAzBD;;ECJA,MAAMI,QAAN,CAAe;EACbC,EAAAA,WAAW,CAACvD,KAAD,EAAQ;EACjB;EACA2C,IAAAA,MAAM,CAACa,cAAP,CAAsBxD,KAAtB,EAA6B,QAA7B,EAAuC;EACrCyD,MAAAA,UAAU,EAAE,KADyB;EAErCzD,MAAAA,KAAK,EAAE;EAF8B,KAAvC;;EAIA,QAAIsC,OAAO,CAACtC,KAAD,CAAX,EAAoB;EAClB;EACAA,MAAAA,KAAK,CAAC0D,SAAN,GAAkBhB,YAAlB;EACA,WAAKW,YAAL,CAAkBrD,KAAlB;EACD,KAJD,MAIO;EACL;EACA,WAAK2D,IAAL,CAAU3D,KAAV;EACD;EACF,GAfY;;;EAiBbqD,EAAAA,YAAY,CAAClB,IAAD,EAAO;EACjB;EACAA,IAAAA,IAAI,CAACW,OAAL,CAAcd,IAAD,IAAU4B,OAAO,CAAC5B,IAAD,CAA9B;EACD;;EAED2B,EAAAA,IAAI,CAACxB,IAAD,EAAO;EACTQ,IAAAA,MAAM,CAACkB,IAAP,CAAY1B,IAAZ,EAAkBW,OAAlB,CAA2BgB,GAAD,IAAS;EACjC;EACAC,MAAAA,cAAc,CAAC5B,IAAD,EAAO2B,GAAP,EAAY3B,IAAI,CAAC2B,GAAD,CAAhB,CAAd;EACD,KAHD;EAID;;EA3BY;EA6Bf;EACA;EACA;EACA;EACA;EACA;EACA;;;EACA,SAASC,cAAT,CAAwBC,GAAxB,EAA6BF,GAA7B,EAAkC9D,KAAlC,EAAyC;EACvC4D,EAAAA,OAAO,CAAC5D,KAAD,CAAP;EACA2C,EAAAA,MAAM,CAACa,cAAP,CAAsBQ,GAAtB,EAA2BF,GAA3B,EAAgC;EAC9BG,IAAAA,GAAG,GAAG;EACJ/E,MAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwB2E,GAAxB,EAA6B9D,KAA7B,EADI;;EAGJ,aAAOA,KAAP;EACD,KAL6B;;EAM9BkE,IAAAA,GAAG,CAACC,MAAD,EAAS;EACV,UAAInE,KAAK,KAAKmE,MAAd,EAAsB;EACpBjF,QAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwB2E,GAAxB,EAA6BK,MAA7B;EACAP,QAAAA,OAAO,CAACO,MAAD,CAAP;EACAnE,QAAAA,KAAK,GAAGmE,MAAR;EACD;EACF;;EAZ6B,GAAhC;EAcD;;EAEM,SAASP,OAAT,CAAiB5D,KAAjB,EAAwB;EAC7B;EACA,MAAI,CAACoC,QAAQ,CAACpC,KAAD,CAAb,EAAsB;EACpB;EACD,GAJ4B;;;EAO7B,MAAIA,KAAK,CAACoD,MAAV,EAAkB;EAChB;EACD,GAT4B;EAY7B;EACA;;;EACA,SAAO,IAAIE,QAAJ,CAAatD,KAAb,CAAP;EACD;;ECrEM,SAASoE,SAAT,CAAmBC,EAAnB,EAAuB;EAC5B,QAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB;;EACA,MAAID,IAAI,CAACnC,IAAT,EAAe;EACbqC,IAAAA,QAAQ,CAACH,EAAD,CAAR;EACD;EACF;;EAED,SAASG,QAAT,CAAkBH,EAAlB,EAAsB;EACpB;EACA,MAAIlC,IAAI,GAAGkC,EAAE,CAACE,QAAH,CAAYpC,IAAvB,CAFoB;EAIpB;EACA;;EACAkC,EAAAA,EAAE,CAACI,KAAH,GAAWtC,IAAI,GAAGD,UAAU,CAACC,IAAD,CAAV,GAAmBA,IAAI,CAACc,IAAL,CAAUoB,EAAV,CAAnB,GAAmClC,IAArD;EAEAyB,EAAAA,OAAO,CAACzB,IAAD,CAAP;;EAEA,OAAK,MAAM2B,GAAX,IAAkB3B,IAAlB,EAAwB;EACtBuC,IAAAA,KAAK,CAACL,EAAD,EAAKP,GAAL,EAAU,OAAV,CAAL;EACD;EACF;EAED;;;EACA,SAASY,KAAT,CAAeL,EAAf,EAAmBP,GAAnB,EAAwBa,MAAxB,EAAgC;EAC9BhC,EAAAA,MAAM,CAACa,cAAP,CAAsBa,EAAtB,EAA0BP,GAA1B,EAA+B;EAC7BG,IAAAA,GAAG,GAAG;EACJ,aAAOI,EAAE,CAACM,MAAD,CAAF,CAAWb,GAAX,CAAP;EACD,KAH4B;;EAI7BI,IAAAA,GAAG,CAACC,MAAD,EAAS;EACVE,MAAAA,EAAE,CAACM,MAAD,CAAF,CAAWb,GAAX,IAAkBK,MAAlB;EACD;;EAN4B,GAA/B;EAQD;;EChCM,SAASS,SAAT,CAAmBC,GAAnB,EAAwB;EAC7B;EACA;EACAA,EAAAA,GAAG,CAACpC,SAAJ,CAAcqC,KAAd,GAAsB,UAAUC,OAAV,EAAmB;EACvC,UAAMV,EAAE,GAAG,IAAX,CADuC;EAGvC;;EACAA,IAAAA,EAAE,CAACE,QAAH,GAAcQ,OAAd;EAEAX,IAAAA,SAAS,CAACC,EAAD,CAAT;;EAEA,QAAIA,EAAE,CAACE,QAAH,CAAYhD,EAAhB,EAAoB;EAClB;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA8C,MAAAA,EAAE,CAACW,MAAH,CAAUX,EAAE,CAACE,QAAH,CAAYhD,EAAtB;EACD;EACF,GAnBD;;EAoBAsD,EAAAA,GAAG,CAACpC,SAAJ,CAAcuC,MAAd,GAAuB,UAAUzD,EAAV,EAAc;EACnC,UAAM8C,EAAE,GAAG,IAAX;EACA,UAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB,CAFmC;;EAInChD,IAAAA,EAAE,GAAG0D,QAAQ,CAACC,aAAT,CAAuB3D,EAAvB,CAAL,CAJmC;;EAMnC8C,IAAAA,EAAE,CAACc,GAAH,GAAS5D,EAAT;;EAEA,QAAI,CAAC+C,IAAI,CAAC5D,MAAV,EAAkB;EAChB;EACA,UAAIJ,QAAQ,GAAGgE,IAAI,CAAChE,QAApB;;EACA,UAAI,CAACA,QAAL,EAAe;EACbA,QAAAA,QAAQ,GAAGiB,EAAE,CAAC6D,SAAd;EACD;;EAED,UAAI1E,MAAM,GAAGL,iBAAiB,CAACC,QAAD,CAA9B;EACAgE,MAAAA,IAAI,CAAC5D,MAAL,GAAcA,MAAd;EACD,KAjBkC;;EAoBpC,GApBD;EAqBD;;EC7CD;EACA;EACA;;EACA,SAASmE,GAAT,CAAaE,OAAb,EAAsB;EACpB;EACA,OAAKD,KAAL,CAAWC,OAAX;EACD;;EAEDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}
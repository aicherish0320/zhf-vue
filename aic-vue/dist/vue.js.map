{"version":3,"file":"vue.js","sources":["../src/compiler/generate.js","../src/compiler/parser.js","../src/compiler/index.js","../src/utils.js","../src/global-api/index.js","../src/observe/dep.js","../src/observe/scheduler.js","../src/observe/watcher.js","../src/vdom/index.js","../src/vdom/patch.js","../src/lifecycle.js","../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/render.js","../src/index.js"],"sourcesContent":["function genProps(attrs) {\r\n  let str = ''\r\n  // { key: value, key: value }\r\n  for (let i = 0; i < attrs.length; i++) {\r\n    let attr = attrs[i]\r\n\r\n    if (attr.name === 'style') {\r\n      let styles = {}\r\n      attr.value.replace(/([^;:]+):([^;:]+)/g, function () {\r\n        styles[arguments[1].trim()] = arguments[2].trim()\r\n      })\r\n      attr.value = styles\r\n    }\r\n\r\n    str += `${attr.name}:${JSON.stringify(attr.value)},`\r\n  }\r\n  return `{${str.slice(0, -1)}}`\r\n}\r\n\r\nfunction gen(el) {\r\n  const defaultTagRE = /\\{\\{((?:.|\\r?\\n)+?)\\}\\}/g\r\n  if (el.type === 1) {\r\n    // 如果是元素就递归生成\r\n    return generate(el)\r\n  } else {\r\n    let text = el.text\r\n    // 说明是普通文本\r\n    if (!defaultTagRE.test(text)) {\r\n      return `_v('${text}')`\r\n    }\r\n    // <div>aa {{ name }} bb</div>\r\n    // 说明有表达式。需要做一个表达式和普通值的拼接 _v('aaa', _s(name), 'bbb')\r\n    let lastIndex = (defaultTagRE.lastIndex = 0)\r\n    let tokens = []\r\n    let match\r\n    // 如果正则 + g，lastIndex\r\n    while ((match = defaultTagRE.exec(text))) {\r\n      let index = match.index\r\n      if (index > lastIndex) {\r\n        tokens.push(JSON.stringify(text.slice(lastIndex, index)))\r\n      }\r\n      tokens.push(`_s(${match[1].trim()})`)\r\n      lastIndex = index + match[0].length\r\n    }\r\n\r\n    if (lastIndex < text.length) {\r\n      tokens.push(JSON.stringify(text.slice(lastIndex)))\r\n    }\r\n\r\n    return `_v(${tokens.join('+')})`\r\n  }\r\n}\r\n\r\nfunction genChildren(el) {\r\n  let children = el.children\r\n  if (children) {\r\n    return children.map((item) => gen(item)).join(',')\r\n  }\r\n  return false\r\n}\r\n\r\nexport function generate(ast) {\r\n  let children = genChildren(ast)\r\n  let code = `_c('${ast.tag}', ${\r\n    ast.attrs.length ? genProps(ast.attrs) : undefined\r\n  }${children ? `,${children}` : ''})`\r\n\r\n  return code\r\n}\r\n","export function parseHTML(html) {\r\n  // 正则\r\n  const ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*` // 匹配标签名\r\n  const qnameCapture = `((?:${ncname}\\\\:)?${ncname})`\r\n  const startTagOpen = new RegExp(`^<${qnameCapture}`) // 匹配标签名\r\n  const endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`) // 匹配标签结束 </aa>\r\n  const attribute =\r\n    /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/ // 匹配属性\r\n  const startTagClose = /^\\s*(\\/?)>/ // 匹配结束标签 > />\r\n  // 构建父子关系\r\n  let stack = []\r\n  let root = null\r\n\r\n  function createASTElement(tag, attrs, parent = null) {\r\n    return {\r\n      tag,\r\n      type: 1,\r\n      children: [],\r\n      parent,\r\n      attrs\r\n    }\r\n  }\r\n  function start(tag, attrs) {\r\n    // 遇到开始标签，就取栈中的最后一个 作为父级\r\n    const parent = stack[stack.length - 1]\r\n    let element = createASTElement(tag, attrs, parent)\r\n    // 说明当前节点就是根节点\r\n    if (root === null) {\r\n      root = element\r\n    }\r\n    if (parent) {\r\n      // 更新父级节点\r\n      element.parent = parent\r\n      parent.children.push(element)\r\n    }\r\n\r\n    stack.push(element)\r\n  }\r\n  function end(tag) {\r\n    const endTag = stack.pop()\r\n    if (endTag.tag !== tag) {\r\n      console.log('标签出错了')\r\n    }\r\n  }\r\n  function text(chars) {\r\n    const parent = stack[stack.length - 1]\r\n    chars = chars.replace(/\\s/g, '')\r\n    if (chars) {\r\n      parent.children.push({\r\n        type: 2,\r\n        text: chars\r\n      })\r\n    }\r\n  }\r\n\r\n  function advance(len) {\r\n    html = html.substring(len)\r\n  }\r\n\r\n  function parseStartTag() {\r\n    const startMatch = html.match(startTagOpen)\r\n    if (startMatch) {\r\n      const match = {\r\n        tagName: startMatch[1],\r\n        attrs: []\r\n      }\r\n      advance(startMatch[0].length)\r\n      // 匹配属性 1. 要有属性，2.不能为开始的结束标签\r\n      let end, attr\r\n      while (\r\n        !(end = html.match(startTagClose)) &&\r\n        (attr = html.match(attribute))\r\n      ) {\r\n        match.attrs.push({\r\n          name: attr[1],\r\n          value: attr[3] || attr[4] || attr[5]\r\n        })\r\n        advance(attr[0].length)\r\n      }\r\n      if (end) {\r\n        advance(end[0].length)\r\n      }\r\n      return match\r\n    }\r\n    return false\r\n  }\r\n\r\n  // 不停的截取模板，直到把模板全部解析完毕\r\n  while (html) {\r\n    // 解析 标签和文本\r\n    let index = html.indexOf('<')\r\n    if (index === 0) {\r\n      // 标签 解析开始标签 并且把属性也解析出来\r\n      const startTagMatch = parseStartTag()\r\n\r\n      if (startTagMatch) {\r\n        // 开始标签\r\n        start(startTagMatch.tagName, startTagMatch.attrs)\r\n        continue\r\n      }\r\n      let endTagMatch\r\n      if ((endTagMatch = html.match(endTag))) {\r\n        // 结束标签\r\n        end(endTagMatch[1])\r\n        advance(endTagMatch[0].length)\r\n        continue\r\n      }\r\n\r\n      break\r\n    }\r\n    // 文本\r\n    if (index > 0) {\r\n      let chars = html.substring(0, index)\r\n      text(chars)\r\n      advance(chars.length)\r\n    }\r\n  }\r\n  return root\r\n}\r\n","import { generate } from './generate'\r\nimport { parseHTML } from './parser'\r\n\r\nexport function compileToFunction(template) {\r\n  // 1. 将模板编程 ast 语法树\r\n  const ast = parseHTML(template)\r\n  // 2. 代码优化 编辑静态节点\r\n  // TODO\r\n  // 3. 代码生成\r\n  const code = generate(ast)\r\n  // 模板引擎的实现原理都是 new Function + with\r\n  const render = new Function(`with(this){return ${code}}`)\r\n  return render\r\n}\r\n","export function isFunction(data) {\r\n  return typeof data === 'function'\r\n}\r\n\r\nexport function isObject(val) {\r\n  return typeof val === 'object' && val !== null\r\n}\r\n\r\nexport function isArray(val) {\r\n  return Array.isArray(val)\r\n}\r\n\r\nlet callbacks = []\r\nlet waiting = false\r\n\r\nfunction flushCallbacks() {\r\n  callbacks.forEach((fn) => fn())\r\n  callbacks = []\r\n  waiting = false\r\n}\r\n\r\nexport function nextTick(fn) {\r\n  // Vue3里面的nextTick 就是 promise ,Vue2里面做了一些兼容处理\r\n  callbacks.push(fn)\r\n  if (!waiting) {\r\n    Promise.resolve().then(flushCallbacks)\r\n    waiting = true\r\n  }\r\n}\r\n\r\n// {} { beforeCreate: fn } => { beforeCreate: [fn] }\r\n// { beforeCreate: [fn] }  => { beforeCreate: [fn, fn] }\r\n// 存放所有策略\r\nconst strats = {}\r\nconst lifecycle = ['beforeCreate', 'created', 'beforeMount', 'mounted']\r\nlifecycle.forEach((hook) => {\r\n  strats[hook] = function (parentVal, childVal) {\r\n    if (childVal) {\r\n      if (parentVal) {\r\n        // 父子都有值 用父和子拼在一起 父有值一定是数组\r\n        return parentVal.concat(childVal)\r\n      } else {\r\n        if (isArray(childVal)) {\r\n          return childVal\r\n        } else {\r\n          return [childVal]\r\n        }\r\n      }\r\n    } else {\r\n      return parentVal\r\n    }\r\n  }\r\n})\r\n\r\nexport function mergeOptions(parentVal, childVal) {\r\n  let options = {}\r\n  for (const key in parentVal) {\r\n    mergeField(key)\r\n  }\r\n\r\n  for (const key in childVal) {\r\n    if (!parentVal.hasOwnProperty(key)) {\r\n      mergeField(key)\r\n    }\r\n  }\r\n  function mergeField(key) {\r\n    // 策略模式\r\n    const strat = strats[key]\r\n    if (strat) {\r\n      options[key] = strat(parentVal[key], childVal[key])\r\n    } else {\r\n      options[key] = childVal[key] || parentVal[key]\r\n    }\r\n  }\r\n  return options\r\n}\r\n","import { mergeOptions } from '../utils'\r\n\r\nexport function initGlobalAPI(Vue) {\r\n  // 全局属性，在每个组件初始化的时候 将这些属性放到每个组件上\r\n  Vue.options = {}\r\n\r\n  Vue.mixin = function (options) {\r\n    this.options = mergeOptions(this.options, options)\r\n    return this\r\n  }\r\n  Vue.component = function (options) {}\r\n  Vue.filter = function (options) {}\r\n  Vue.directive = function (options) {}\r\n}\r\n","let id = 0\r\n\r\nclass Dep {\r\n  // 把 watcher 放到 dep 中\r\n  constructor() {\r\n    this.subs = []\r\n    this.id = id++\r\n  }\r\n  depend() {\r\n    // 让 dep 记住这个 watcher\r\n    // this.subs.push(Dep.target)\r\n    Dep.target.addDep(this)\r\n  }\r\n  addSub(watcher) {\r\n    // 让 dep 记住 watcher\r\n    this.subs.push(watcher)\r\n  }\r\n  notify() {\r\n    this.subs.forEach((w) => w.update())\r\n  }\r\n}\r\n\r\n// 这里用了一个全局的变量\r\nDep.target = null\r\n\r\nexport default Dep\r\n","import { nextTick } from '../utils'\r\n\r\n// 这里存放要更新的 watcher\r\nlet queue = []\r\n// 用来存放已有的 watcher 的 id\r\nlet has = {}\r\n\r\nlet pending = false\r\n\r\nfunction flushSchedulerQueue() {\r\n  queue.forEach((watcher) => watcher.run())\r\n  queue = []\r\n  has = {}\r\n  pending = false\r\n}\r\n\r\nexport function queueWatcher(watcher) {\r\n  const id = watcher.id\r\n  if (!has[id]) {\r\n    has[id] = true\r\n    queue.push(watcher)\r\n\r\n    if (!pending) {\r\n      nextTick(flushSchedulerQueue)\r\n      pending = true\r\n    }\r\n  }\r\n}\r\n","import Dep from './dep'\r\nimport { queueWatcher } from './scheduler'\r\nlet id = 0\r\nclass Watcher {\r\n  // 要将 dep 放到 watcher 中\r\n  constructor(vm, fn, cb, options) {\r\n    this.vm = vm\r\n    this.fn = fn\r\n    this.cb = cb\r\n    this.options = options\r\n\r\n    this.id = id++\r\n\r\n    this.depsId = new Set()\r\n    this.deps = []\r\n    // fn 就是页面渲染逻辑\r\n    this.getters = fn\r\n    // 表示一上来就做一次初始化\r\n    this.get()\r\n  }\r\n  get() {\r\n    // 利用了 js 单线程特性\r\n    Dep.target = this\r\n    // 页面渲染的逻辑\r\n    this.getters()\r\n    Dep.target = null\r\n  }\r\n  addDep(dep) {\r\n    const dId = dep.id\r\n\r\n    if (!this.depsId.has(dId)) {\r\n      this.depsId.add(dId)\r\n      this.deps.push(dep)\r\n\r\n      dep.addSub(this)\r\n    }\r\n  }\r\n  update() {\r\n    // 每次更新数据都会同步调用这个 update 方法，我可以将更新的逻辑缓存起来，等会同步更新数据的逻辑执行完毕后，依次调用。（去重逻辑）\r\n    // 可以做异步更新处理\r\n    queueWatcher(this)\r\n    // this.get()\r\n  }\r\n  run() {\r\n    this.get()\r\n  }\r\n}\r\n\r\nexport default Watcher\r\n","// 返回虚拟节点\r\nexport function createElement(vm, tag, data = {}, ...children) {\r\n  return vnode(vm, tag, data, children, data.key, undefined)\r\n}\r\nexport function createText(vm, text) {\r\n  return vnode(vm, undefined, undefined, undefined, undefined, text)\r\n}\r\n// 看两个节点是不是相同节点 判断 tag 和 Key\r\n// Vue2 性能问题 递归比对\r\nexport function isSameVNode(newVNode, oldVNode) {\r\n  return newVNode.tag === oldVNode.tag && newVNode.key === oldVNode.key\r\n}\r\n\r\nfunction vnode(vm, tag, data, children, key, text) {\r\n  return {\r\n    vm,\r\n    tag,\r\n    data,\r\n    children,\r\n    key,\r\n    text\r\n  }\r\n}\r\n","import { isSameVNode } from '.'\r\n\r\nexport function patch(oldVNode, vNode) {\r\n  const isRealElement = oldVNode.nodeType\r\n  if (isRealElement) {\r\n    // 根据虚拟节点 渲染成真实节点\r\n    const elm = createElm(vNode)\r\n    const parentNode = oldVNode.parentNode\r\n    parentNode.insertBefore(elm, oldVNode.nextSibling)\r\n    parentNode.removeChild(oldVNode)\r\n    // 删除老节点 根据 vNode 创建新节点 替换掉老节点\r\n    return elm\r\n  } else {\r\n    // diff: 同层比对，如果不一样，儿子就不用比对了，根据当前节点，创建儿子，全部替换\r\n    // 如果新旧节点 不是同一个 删除老的换成新的\r\n    if (!isSameVNode(oldVNode, vNode)) {\r\n      return oldVNode.el.parentNode.replaceChild(createElm(vNode), oldVNode.el)\r\n    }\r\n    // 复用节点\r\n    const el = (vNode.el = oldVNode.el)\r\n    if (!oldVNode.tag) {\r\n      // 文本 直接更新即可 一个是文本 另一个也是文本\r\n      if (oldVNode.text !== vNode.text) {\r\n        return (el.textContent = vNode.text)\r\n      }\r\n    }\r\n    // 元素\r\n    updateProperties(vNode, oldVNode.data)\r\n    // 相同节点，复用节点，再更新不一样的地方\r\n\r\n    // 比较儿子节点\r\n    const oldChildren = oldVNode.children || []\r\n    const newChildren = vNode.children || []\r\n    // 1. 老的有儿子 新的没儿子\r\n    if (oldChildren.length > 0 && newChildren.length === 0) {\r\n      el.innerHTML = ''\r\n    } else if (newChildren.length > 0 && oldChildren.length === 0) {\r\n      // 新的有儿子 老的没儿子 直接将新的插入即可\r\n      newChildren.forEach((child) => el.appendChild(createElm(child)))\r\n    } else {\r\n      // 新老都有儿子\r\n      updateChildren(el, oldChildren, newChildren)\r\n    }\r\n  }\r\n}\r\n// 面试问：虚拟节点的实现 虚拟节点 -> 真实节点\r\nexport function createElm(vNode) {\r\n  const { tag, data, children, text, vm } = vNode\r\n  // 让虚拟节点和真实节点做一个映射，后续某个虚拟节点更新了 我们可以跟踪到真实节点，并且更新真实节点\r\n  if (typeof tag === 'string') {\r\n    vNode.el = document.createElement(tag)\r\n    updateProperties(vNode)\r\n    children.forEach((child) => {\r\n      vNode.el.appendChild(createElm(child))\r\n    })\r\n  } else {\r\n    // 文本\r\n    vNode.el = document.createTextNode(text)\r\n  }\r\n  return vNode.el\r\n}\r\n\r\nfunction updateProperties(vNode, oldProps = {}) {\r\n  // 这里的逻辑可能是初次渲染，初次渲染 直接用 oldVNode给VNode的el赋值即可\r\n  // 更新逻辑 拿到老的 props 和 VNode里面的 data 进行比对\r\n  const el = vNode.el\r\n  const newProps = vNode.data || {}\r\n  const newStyle = newProps.style || {}\r\n  const oldStyle = oldProps.style || {}\r\n  for (const key in oldStyle) {\r\n    // 老的样式有，新的没有，就把页面上的样式删除掉\r\n    if (!newStyle[key]) {\r\n      el.style[key] = ''\r\n    }\r\n  }\r\n  // 新旧比对，两个对象如何对比差异\r\n  for (const key in newProps) {\r\n    // 直接用新的覆盖老的\r\n    if (key === 'style') {\r\n      for (const key in newStyle) {\r\n        // { style: { color: red } }\r\n        el.style[key] = newStyle[key]\r\n      }\r\n    } else {\r\n      el.setAttribute(key, newProps[key])\r\n    }\r\n  }\r\n  for (const key in oldProps) {\r\n    if (!newProps[key]) {\r\n      el.removeAttribute(key)\r\n    }\r\n  }\r\n}\r\n\r\n// Vue2 中如何做的diff\r\nfunction updateChildren(el, oldChildren, newChildren) {\r\n  // Vue内部做了优化 （能尽量提升性能，如果实在不行，再暴力比对）\r\n  // 1. 在列表中新增和删除的情况\r\n  let oldStartIndex = 0\r\n  let oldStartVNode = oldChildren[0]\r\n  let oldEndIndex = oldChildren.length - 1\r\n  let oldEndVNode = oldChildren[oldEndIndex]\r\n\r\n  let newStartIndex = 0\r\n  let newStartVNode = newChildren[0]\r\n  let newEndIndex = newChildren.length - 1\r\n  let newEndVNode = newChildren[newEndIndex]\r\n\r\n  function makeKeyByIndex(children) {\r\n    const map = {}\r\n    children.forEach((item, index) => {\r\n      map[item.key] = index\r\n    })\r\n    return map\r\n  }\r\n  const mapping = makeKeyByIndex(oldChildren)\r\n\r\n  // diff 算法的复杂度 o(n)\r\n  while (oldStartIndex <= oldEndIndex && newStartIndex <= newEndIndex) {\r\n    // 在指针移动的时候 可能元素已经被移动走了那就跳过这一项\r\n    if (!oldStartVNode) {\r\n      oldStartVNode = oldChildren[++oldStartIndex]\r\n    } else if (!oldEndVNode) {\r\n      oldEndVNode = oldChildren[--oldEndIndex]\r\n    } else if (isSameVNode(oldStartVNode, newStartVNode)) {\r\n      // 会递归比较子节点 同时比对这两个的差异\r\n      patch(oldStartVNode, newStartVNode)\r\n      oldStartVNode = oldChildren[++oldStartIndex]\r\n      newStartVNode = newChildren[++newStartIndex]\r\n    } else if (isSameVNode(oldEndVNode, newEndVNode)) {\r\n      patch(oldEndVNode, newEndVNode)\r\n      oldEndVNode = oldChildren[--oldEndIndex]\r\n      newEndVNode = newChildren[--newEndIndex]\r\n    } else if (isSameVNode(oldStartVNode, newEndVNode)) {\r\n      patch(oldStartVNode, newEndVNode)\r\n\r\n      el.insertBefore(oldStartVNode.el, oldEndVNode.el.nextSibling)\r\n\r\n      oldStartVNode = oldChildren[++oldStartIndex]\r\n      newEndVNode = newChildren[--newEndIndex]\r\n    } else if (isSameVNode(oldEndVNode, newStartVNode)) {\r\n      patch(oldEndVNode, newStartVNode)\r\n      el.insertBefore(oldEndVNode.el, oldStartVNode.el)\r\n      oldEndVNode = oldChildren[--oldEndIndex]\r\n      newStartVNode = newChildren[++newStartIndex]\r\n    } else {\r\n      // 之前的逻辑都是考虑，用户一些特殊情况，但是有非特殊的 乱序排\r\n      let moveIndex = mapping[newStartVNode.key]\r\n      if (!moveIndex) {\r\n        // 没有直接将节点插入到开头的前面\r\n        el.insertBefore(createElm(newStartVNode), oldStartVNode.el)\r\n      } else {\r\n        // 有的话就复用\r\n        const moveVNode = oldChildren[moveIndex]\r\n        el.insertBefore(moveVNode.el, oldStartVNode.el)\r\n        patch(moveVNode, newStartVNode)\r\n        // 将移动的节点标记为空\r\n        oldChildren[moveIndex] = null\r\n      }\r\n      newStartVNode = newChildren[++newStartIndex]\r\n    }\r\n  }\r\n  if (newStartIndex <= newEndIndex) {\r\n    const anchor =\r\n      newChildren[newEndIndex + 1] == null\r\n        ? null\r\n        : newChildren[newEndIndex + 1].el\r\n    for (let i = newStartIndex; i <= newEndIndex; i++) {\r\n      // 看一下 当前尾结点的下一个元素是否存在 如果存在则是插入到下一个元素的前面\r\n      // 如果下一个是 Null，就是 appendChild\r\n      // 这里可能是向前追加 可能是向后追加\r\n      // anchor 是 Null 的时候，相当于 appendChild\r\n      el.insertBefore(createElm(newChildren[i]), anchor)\r\n    }\r\n  }\r\n  if (oldStartIndex <= oldEndIndex) {\r\n    for (let i = oldStartIndex; i <= oldEndIndex; i++) {\r\n      // 老的多余的 需要清理掉 直接删除即可\r\n      const child = oldChildren[i]\r\n      // 因为 child 可能是 null\r\n      child && el.removeChild(child.el)\r\n    }\r\n  }\r\n}\r\n","import Watcher from './observe/watcher'\r\nimport { patch } from './vdom/patch'\r\n\r\nexport function mountComponent(vm) {\r\n  const updateComponent = () => {\r\n    vm._update(vm._render())\r\n  }\r\n  callHook(vm, 'beforeCreate')\r\n  // 每个组件 都有一个 watcher，我们把这个 watcher 称之为渲染 watcher\r\n  new Watcher(\r\n    vm,\r\n    updateComponent,\r\n    () => {\r\n      console.log('后续添加更新钩子函数 update')\r\n      callHook(vm, 'created')\r\n    },\r\n    true\r\n  )\r\n\r\n  callHook(vm, 'mounted')\r\n}\r\n\r\nexport function lifecycleMixin(vue) {\r\n  vue.prototype._update = function (vnode) {\r\n    // 采用的是 先序深度遍历 创建节点 （遇到节点就创造节点，递归创建）\r\n    const vm = this\r\n    // 第一次渲染 是根据虚拟节点 生成真实节点 替换掉原来的节点\r\n    // 第二次 生成一个新的虚拟节点和老的虚拟节点进行对比\r\n    vm.$el = patch(vm.$el, vnode)\r\n  }\r\n}\r\n\r\nexport function callHook(vm, hook) {\r\n  const handlers = vm.$options[hook]\r\n  if (handlers) {\r\n    handlers.forEach((fn) => {\r\n      // 生命周期的 this 永远指向实例\r\n      fn.call(vm)\r\n    })\r\n  }\r\n}\r\n","// 获取数组的老的原型方法\r\nconst oldArrayPrototype = Array.prototype\r\n// 让 arrayMethods 通过 __proto__ 能获取到数组的方法\r\nexport const arrayMethods = Object.create(oldArrayPrototype)\r\n// 只有这7个方法可以导致数组发生变化\r\nconst methods = ['push', 'pop', 'unshift', 'reverse', 'sort', 'splice', 'shift']\r\n\r\nmethods.forEach((method) => {\r\n  // 属性的查找，是先找自己身上的，找不到去原型上查找\r\n  arrayMethods[method] = function (...args) {\r\n    // 数组新增的属性 要看一下是不是对象 如果是对象 则继续进行劫持\r\n    // 需要调用数组原生逻辑\r\n    oldArrayPrototype[method].call(this, ...args)\r\n    // TODO... 可以添加自己的逻辑 函数劫持 切片\r\n    let inserted = null\r\n    let ob = this.__ob__\r\n    switch (method) {\r\n      // 修改 删除 添加\r\n      case 'splice':\r\n        inserted = args.slice(2) // splice 方法从第三个参数起 是添加的新数据\r\n        break\r\n      case 'push':\r\n      case 'unshift':\r\n        // 调用 push/unshift 传递的参数就是新增的逻辑\r\n        inserted = args\r\n        break\r\n    }\r\n    // inserted 遍历数组，看一个它是否需要进行再次劫持\r\n    if (inserted) {\r\n      ob.observeArray(inserted)\r\n    }\r\n    ob.dep.notify()\r\n  }\r\n})\r\n","import { isArray, isObject } from '../utils'\r\nimport { arrayMethods } from './array'\r\nimport Dep from './dep'\r\n\r\nclass Observer {\r\n  constructor(value) {\r\n    // 每一个 value 身上有一个 Observer，每个 Observer 都有一个 dep\r\n    // 如果给一个对象添加一个不存在的属性，我希望也能更新视图 {}.dep => watcher $set\r\n    // 给 对象和数组 添加 dep 属性\r\n    this.dep = new Dep() // value 是对象和数组 value.__ob__.dep\r\n    // 给对象和数组添加一个自定义属性\r\n    Object.defineProperty(value, '__ob__', {\r\n      enumerable: false,\r\n      value: this\r\n    })\r\n    if (isArray(value)) {\r\n      // 更改数组原型方法\r\n      value.__proto__ = arrayMethods\r\n      this.observeArray(value)\r\n    } else {\r\n      // 核心就是循环对象\r\n      this.walk(value)\r\n    }\r\n  }\r\n  // 递归遍历数组，对数组内部的对象再次重写\r\n  observeArray(data) {\r\n    // 数组里面如果是引用类型那么是响应式的\r\n    data.forEach((item) => observe(item))\r\n  }\r\n\r\n  walk(data) {\r\n    Object.keys(data).forEach((key) => {\r\n      // 使用 defineProperty 重新定义\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\n// 让数组里的引用类型都收集依赖\r\n// JSON.stringify 默认会取 对象中的属性 进行一次收集 { foo: { bar: 'bar' } }\r\nfunction dependArray(value) {\r\n  for (let i = 0; i < value.length; i++) {\r\n    const current = value[i]\r\n    current.__ob__ && current.__ob__.dep.depend()\r\n\r\n    if (Array.isArray(current)) {\r\n      dependArray(current)\r\n    }\r\n  }\r\n}\r\n/*\r\n  性能优化的原则\r\n    1. 不要把所有的数据都放在 data 中\r\n    2. 不要写数据的时候，层次过深；尽量扁平化数据\r\n    3. 不要频繁获取数据\r\n    4. 数据不需要响应式，可以使用 Object.freeze 冻结属性\r\n*/\r\nfunction defineReactive(obj, key, value) {\r\n  // childOb 如果有值 那么就是数组或者对象\r\n  let childOb = observe(value)\r\n\r\n  // 每个属性对应一个 dep\r\n  const dep = new Dep()\r\n\r\n  Object.defineProperty(obj, key, {\r\n    get() {\r\n      if (Dep.target) {\r\n        // 对象本身收集\r\n        dep.depend()\r\n\r\n        // 取属性的时候，会对对象本身和数组进行依赖收集\r\n        // 数组和对象在这都会进行依赖收集\r\n        // 对象属性收集\r\n        if (childOb) {\r\n          childOb.dep.depend()\r\n          if (Array.isArray(value)) {\r\n            // 可能是数组套数组\r\n            dependArray(value)\r\n          }\r\n        }\r\n      }\r\n\r\n      // console.log('get >>> ', key, value)\r\n      // 闭包，value 会向上层查找\r\n      return value\r\n    },\r\n    set(newVal) {\r\n      if (value !== newVal) {\r\n        // console.log('set >>> ', key, newVal)\r\n        observe(newVal)\r\n        value = newVal\r\n        // 拿到当前的 dep 里面的 watcher 依次执行\r\n        dep.notify()\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nexport function observe(value) {\r\n  // 如果 value 不是对象，那么就不用观察了\r\n  if (!isObject(value)) {\r\n    return\r\n  }\r\n\r\n  // 一个对象不需要重新被观测\r\n  if (value.__ob__) {\r\n    return\r\n  }\r\n\r\n  // 需要对对象进行观测 （最外层必须是一个 {}， 不能是数组）\r\n  // 如果一个数据已经被观测过了，就不要再进行观测了，用类来实现，观测过了就增加一个标识\r\n  // 在观测的时候，可以先检测是否观测过了，如果观测过了就跳过检测\r\n  return new Observer(value)\r\n}\r\n","import { observe } from './observe'\r\nimport { isFunction } from './utils'\r\n\r\nexport function initState(vm) {\r\n  const opts = vm.$options\r\n  if (opts.data) {\r\n    initData(vm)\r\n  }\r\n}\r\n\r\nfunction initData(vm) {\r\n  // 用户传入的数据\r\n  let data = vm.$options.data\r\n  // 如果用户传递的是一个函数 则取函数的返回值作为data\r\n  // 只有根实例的data可以一个对象\r\n  // 需要将 data 变成响应式的 `Object.defineProperty`，重写 `data` 中的所有属性\r\n  vm._data = data = isFunction(data) ? data.call(vm) : data\r\n\r\n  observe(data)\r\n\r\n  for (const key in data) {\r\n    proxy(vm, key, '_data')\r\n  }\r\n}\r\n// 将数据代理带 vm 上\r\n// 取值的时候做代理，不是暴力的把 _data 属性赋予给 vm，而且直接赋值会有命名冲突问题\r\nfunction proxy(vm, key, source) {\r\n  Object.defineProperty(vm, key, {\r\n    get() {\r\n      return vm[source][key]\r\n    },\r\n    set(newVal) {\r\n      vm[source][key] = newVal\r\n    }\r\n  })\r\n}\r\n","import { compileToFunction } from './compiler'\r\nimport { mountComponent } from './lifecycle'\r\nimport { initState } from './state'\r\nimport { mergeOptions, nextTick } from './utils'\r\n\r\nexport function initMixin(Vue) {\r\n  // 后续组件化开发的时候 Vue.extend 可以创造一个子组件，子组件可以继承 Vue，子组件也可以调用\r\n  // _init 方法\r\n  Vue.prototype._init = function (options) {\r\n    const vm = this\r\n    // 把用户的选项放到 vm 上，这样在其他方法中都可以获取到 options\r\n    // 为了后续扩展的方法，都可以获取 $options 选项\r\n    vm.$options = mergeOptions(vm.constructor.options, options)\r\n\r\n    initState(vm)\r\n\r\n    if (vm.$options.el) {\r\n      // 要将数据挂载到页面上\r\n      // 数据变化需要更新视图，diff 算法更新需要更新的部分\r\n      // vue -> template（写起来更方便）\r\n      // vue3 -> template 写起来性能会更高，内部做了很多优化\r\n      // template -> ast 语法树（用来描述语法的，虚拟 DOM 描述 DOM 节点）-> 描述成一个树结构 -> 将代码重组成 JS 语法\r\n      // 模板编译原理：把template模板编译成 render 函数，render 函数返回 虚拟DOM -> diff 算法对比虚拟DOM\r\n      // ast -> render -> vNode -> 真实DOM\r\n      // 更新的时候 再次调用 render 生成新的vNode -> 新旧比对 -> 更新真实DOM\r\n      vm.$mount(vm.$options.el)\r\n    }\r\n  }\r\n  Vue.prototype.$mount = function (el) {\r\n    const vm = this\r\n    const opts = vm.$options\r\n    // 获取真实的元素\r\n    el = document.querySelector(el)\r\n    // 页面真实元素\r\n    vm.$el = el\r\n\r\n    if (!opts.render) {\r\n      // 模板编译\r\n      let template = opts.template\r\n      if (!template) {\r\n        template = el.outerHTML\r\n      }\r\n\r\n      let render = compileToFunction(template)\r\n      opts.render = render\r\n    }\r\n    mountComponent(vm)\r\n  }\r\n  Vue.prototype.$nextTick = nextTick\r\n}\r\n","import { isObject } from './utils'\r\nimport { createElement, createText } from './vdom'\r\n\r\nexport function renderMixin(Vue) {\r\n  // 创建元素\r\n  Vue.prototype._c = function () {\r\n    const vm = this\r\n    return createElement(vm, ...arguments)\r\n  }\r\n  // 创建文本虚拟节点\r\n  Vue.prototype._v = function (text) {\r\n    const vm = this\r\n    return createText(vm, text)\r\n  }\r\n  // stringify()\r\n  Vue.prototype._s = function (val) {\r\n    if (isObject(val)) {\r\n      return JSON.stringify(val)\r\n    }\r\n    return val\r\n  }\r\n  Vue.prototype._render = function () {\r\n    const vm = this\r\n    const { render } = vm.$options\r\n    const vnode = render.call(vm)\r\n    return vnode\r\n  }\r\n}\r\n","import { compileToFunction } from './compiler'\r\nimport { initGlobalAPI } from './global-api'\r\nimport { initMixin } from './init'\r\nimport { lifecycleMixin } from './lifecycle'\r\nimport { renderMixin } from './render'\r\nimport { createElm, patch } from './vdom/patch'\r\n\r\n/*\r\n  Vue 通过原型的模式来实现扩展的\r\n*/\r\nfunction Vue(options) {\r\n  // 实现 Vue 的初始化功能\r\n  this._init(options)\r\n}\r\n\r\ninitMixin(Vue)\r\nrenderMixin(Vue)\r\nlifecycleMixin(Vue)\r\ninitGlobalAPI(Vue)\r\n\r\n// 先生成一个虚拟节点\r\nconst vm1 = new Vue({\r\n  data() {\r\n    return {\r\n      name: 'aicherish'\r\n    }\r\n  }\r\n})\r\nconst render1 = compileToFunction(`<div >\r\n  <li key=\"A\">A</li>\r\n  <li key=\"B\">B</li>\r\n  <li key=\"C\">C</li>\r\n  <li key=\"D\">D</li>\r\n</div>`)\r\nconst oldVNode = render1.call(vm1)\r\nconst el1 = createElm(oldVNode)\r\ndocument.body.appendChild(el1)\r\n// 新的虚拟节点\r\nconst vm2 = new Vue({\r\n  data() {\r\n    return {\r\n      name: 'aic'\r\n    }\r\n  }\r\n})\r\nconst render2 = compileToFunction(`<div >\r\n  <li key=\"F\" style=\"color: red\">F</li>\r\n  <li key=\"B\" style=\"color: blue\">B</li>\r\n  <li key=\"A\" style=\"color: cyan\">A</li>\r\n  <li key=\"E\" style=\"color: orange\">E</li>\r\n  <li key=\"P\" style=\"color: green\">P</li>\r\n</div>`)\r\nconst newVNode = render2.call(vm2)\r\nsetTimeout(() => {\r\n  patch(oldVNode, newVNode)\r\n}, 2000)\r\n\r\nexport default Vue\r\n"],"names":["genProps","attrs","str","i","length","attr","name","styles","value","replace","arguments","trim","JSON","stringify","slice","gen","el","defaultTagRE","type","generate","text","test","lastIndex","tokens","match","exec","index","push","join","genChildren","children","map","item","ast","code","tag","undefined","parseHTML","html","ncname","qnameCapture","startTagOpen","RegExp","endTag","attribute","startTagClose","stack","root","createASTElement","parent","start","element","end","pop","console","log","chars","advance","len","substring","parseStartTag","startMatch","tagName","indexOf","startTagMatch","endTagMatch","compileToFunction","template","render","Function","isFunction","data","isObject","val","isArray","Array","callbacks","waiting","flushCallbacks","forEach","fn","nextTick","Promise","resolve","then","strats","lifecycle","hook","parentVal","childVal","concat","mergeOptions","options","key","mergeField","hasOwnProperty","strat","initGlobalAPI","Vue","mixin","component","filter","directive","id","Dep","constructor","subs","depend","target","addDep","addSub","watcher","notify","w","update","queue","has","pending","flushSchedulerQueue","run","queueWatcher","Watcher","vm","cb","depsId","Set","deps","getters","get","dep","dId","add","createElement","vnode","createText","isSameVNode","newVNode","oldVNode","patch","vNode","isRealElement","nodeType","elm","createElm","parentNode","insertBefore","nextSibling","removeChild","replaceChild","textContent","updateProperties","oldChildren","newChildren","innerHTML","child","appendChild","updateChildren","document","createTextNode","oldProps","newProps","newStyle","style","oldStyle","setAttribute","removeAttribute","oldStartIndex","oldStartVNode","oldEndIndex","oldEndVNode","newStartIndex","newStartVNode","newEndIndex","newEndVNode","makeKeyByIndex","mapping","moveIndex","moveVNode","anchor","mountComponent","updateComponent","_update","_render","callHook","lifecycleMixin","vue","prototype","$el","handlers","$options","call","oldArrayPrototype","arrayMethods","Object","create","methods","method","args","inserted","ob","__ob__","observeArray","Observer","defineProperty","enumerable","__proto__","walk","observe","keys","defineReactive","dependArray","current","obj","childOb","set","newVal","initState","opts","initData","_data","proxy","source","initMixin","_init","$mount","querySelector","outerHTML","$nextTick","renderMixin","_c","_v","_s","vm1","render1","el1","body","vm2","render2","setTimeout"],"mappings":";;;;;;EAAA,SAASA,QAAT,CAAkBC,KAAlB,EAAyB;EACvB,MAAIC,GAAG,GAAG,EAAV,CADuB;;EAGvB,OAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,KAAK,CAACG,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;EACrC,QAAIE,IAAI,GAAGJ,KAAK,CAACE,CAAD,CAAhB;;EAEA,QAAIE,IAAI,CAACC,IAAL,KAAc,OAAlB,EAA2B;EACzB,UAAIC,MAAM,GAAG,EAAb;EACAF,MAAAA,IAAI,CAACG,KAAL,CAAWC,OAAX,CAAmB,oBAAnB,EAAyC,YAAY;EACnDF,QAAAA,MAAM,CAACG,SAAS,CAAC,CAAD,CAAT,CAAaC,IAAb,EAAD,CAAN,GAA8BD,SAAS,CAAC,CAAD,CAAT,CAAaC,IAAb,EAA9B;EACD,OAFD;EAGAN,MAAAA,IAAI,CAACG,KAAL,GAAaD,MAAb;EACD;;EAEDL,IAAAA,GAAG,IAAK,GAAEG,IAAI,CAACC,IAAK,IAAGM,IAAI,CAACC,SAAL,CAAeR,IAAI,CAACG,KAApB,CAA2B,GAAlD;EACD;;EACD,SAAQ,IAAGN,GAAG,CAACY,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAAiB,GAA5B;EACD;;EAED,SAASC,GAAT,CAAaC,EAAb,EAAiB;EACf,QAAMC,YAAY,GAAG,0BAArB;;EACA,MAAID,EAAE,CAACE,IAAH,KAAY,CAAhB,EAAmB;EACjB;EACA,WAAOC,QAAQ,CAACH,EAAD,CAAf;EACD,GAHD,MAGO;EACL,QAAII,IAAI,GAAGJ,EAAE,CAACI,IAAd,CADK;;EAGL,QAAI,CAACH,YAAY,CAACI,IAAb,CAAkBD,IAAlB,CAAL,EAA8B;EAC5B,aAAQ,OAAMA,IAAK,IAAnB;EACD,KALI;EAOL;;;EACA,QAAIE,SAAS,GAAIL,YAAY,CAACK,SAAb,GAAyB,CAA1C;EACA,QAAIC,MAAM,GAAG,EAAb;EACA,QAAIC,KAAJ,CAVK;;EAYL,WAAQA,KAAK,GAAGP,YAAY,CAACQ,IAAb,CAAkBL,IAAlB,CAAhB,EAA0C;EACxC,UAAIM,KAAK,GAAGF,KAAK,CAACE,KAAlB;;EACA,UAAIA,KAAK,GAAGJ,SAAZ,EAAuB;EACrBC,QAAAA,MAAM,CAACI,IAAP,CAAYf,IAAI,CAACC,SAAL,CAAeO,IAAI,CAACN,KAAL,CAAWQ,SAAX,EAAsBI,KAAtB,CAAf,CAAZ;EACD;;EACDH,MAAAA,MAAM,CAACI,IAAP,CAAa,MAAKH,KAAK,CAAC,CAAD,CAAL,CAASb,IAAT,EAAgB,GAAlC;EACAW,MAAAA,SAAS,GAAGI,KAAK,GAAGF,KAAK,CAAC,CAAD,CAAL,CAASpB,MAA7B;EACD;;EAED,QAAIkB,SAAS,GAAGF,IAAI,CAAChB,MAArB,EAA6B;EAC3BmB,MAAAA,MAAM,CAACI,IAAP,CAAYf,IAAI,CAACC,SAAL,CAAeO,IAAI,CAACN,KAAL,CAAWQ,SAAX,CAAf,CAAZ;EACD;;EAED,WAAQ,MAAKC,MAAM,CAACK,IAAP,CAAY,GAAZ,CAAiB,GAA9B;EACD;EACF;;EAED,SAASC,WAAT,CAAqBb,EAArB,EAAyB;EACvB,MAAIc,QAAQ,GAAGd,EAAE,CAACc,QAAlB;;EACA,MAAIA,QAAJ,EAAc;EACZ,WAAOA,QAAQ,CAACC,GAAT,CAAcC,IAAD,IAAUjB,GAAG,CAACiB,IAAD,CAA1B,EAAkCJ,IAAlC,CAAuC,GAAvC,CAAP;EACD;;EACD,SAAO,KAAP;EACD;;EAEM,SAAST,QAAT,CAAkBc,GAAlB,EAAuB;EAC5B,MAAIH,QAAQ,GAAGD,WAAW,CAACI,GAAD,CAA1B;EACA,MAAIC,IAAI,GAAI,OAAMD,GAAG,CAACE,GAAI,MACxBF,GAAG,CAAChC,KAAJ,CAAUG,MAAV,GAAmBJ,QAAQ,CAACiC,GAAG,CAAChC,KAAL,CAA3B,GAAyCmC,SAC1C,GAAEN,QAAQ,GAAI,IAAGA,QAAS,EAAhB,GAAoB,EAAG,GAFlC;EAIA,SAAOI,IAAP;EACD;;ECpEM,SAASG,SAAT,CAAmBC,IAAnB,EAAyB;EAC9B;EACA,QAAMC,MAAM,GAAI,8BAAhB,CAF8B;;EAG9B,QAAMC,YAAY,GAAI,OAAMD,MAAO,QAAOA,MAAO,GAAjD;EACA,QAAME,YAAY,GAAG,IAAIC,MAAJ,CAAY,KAAIF,YAAa,EAA7B,CAArB,CAJ8B;;EAK9B,QAAMG,MAAM,GAAG,IAAID,MAAJ,CAAY,QAAOF,YAAa,QAAhC,CAAf,CAL8B;;EAM9B,QAAMI,SAAS,GACb,2EADF,CAN8B;;EAQ9B,QAAMC,aAAa,GAAG,YAAtB,CAR8B;EAS9B;;EACA,MAAIC,KAAK,GAAG,EAAZ;EACA,MAAIC,IAAI,GAAG,IAAX;;EAEA,WAASC,gBAAT,CAA0Bb,GAA1B,EAA+BlC,KAA/B,EAAsCgD,MAAM,GAAG,IAA/C,EAAqD;EACnD,WAAO;EACLd,MAAAA,GADK;EAELjB,MAAAA,IAAI,EAAE,CAFD;EAGLY,MAAAA,QAAQ,EAAE,EAHL;EAILmB,MAAAA,MAJK;EAKLhD,MAAAA;EALK,KAAP;EAOD;;EACD,WAASiD,KAAT,CAAef,GAAf,EAAoBlC,KAApB,EAA2B;EACzB;EACA,UAAMgD,MAAM,GAAGH,KAAK,CAACA,KAAK,CAAC1C,MAAN,GAAe,CAAhB,CAApB;EACA,QAAI+C,OAAO,GAAGH,gBAAgB,CAACb,GAAD,EAAMlC,KAAN,EAAagD,MAAb,CAA9B,CAHyB;;EAKzB,QAAIF,IAAI,KAAK,IAAb,EAAmB;EACjBA,MAAAA,IAAI,GAAGI,OAAP;EACD;;EACD,QAAIF,MAAJ,EAAY;EACV;EACAE,MAAAA,OAAO,CAACF,MAAR,GAAiBA,MAAjB;EACAA,MAAAA,MAAM,CAACnB,QAAP,CAAgBH,IAAhB,CAAqBwB,OAArB;EACD;;EAEDL,IAAAA,KAAK,CAACnB,IAAN,CAAWwB,OAAX;EACD;;EACD,WAASC,GAAT,CAAajB,GAAb,EAAkB;EAChB,UAAMQ,MAAM,GAAGG,KAAK,CAACO,GAAN,EAAf;;EACA,QAAIV,MAAM,CAACR,GAAP,KAAeA,GAAnB,EAAwB;EACtBmB,MAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ;EACD;EACF;;EACD,WAASnC,IAAT,CAAcoC,KAAd,EAAqB;EACnB,UAAMP,MAAM,GAAGH,KAAK,CAACA,KAAK,CAAC1C,MAAN,GAAe,CAAhB,CAApB;EACAoD,IAAAA,KAAK,GAAGA,KAAK,CAAC/C,OAAN,CAAc,KAAd,EAAqB,EAArB,CAAR;;EACA,QAAI+C,KAAJ,EAAW;EACTP,MAAAA,MAAM,CAACnB,QAAP,CAAgBH,IAAhB,CAAqB;EACnBT,QAAAA,IAAI,EAAE,CADa;EAEnBE,QAAAA,IAAI,EAAEoC;EAFa,OAArB;EAID;EACF;;EAED,WAASC,OAAT,CAAiBC,GAAjB,EAAsB;EACpBpB,IAAAA,IAAI,GAAGA,IAAI,CAACqB,SAAL,CAAeD,GAAf,CAAP;EACD;;EAED,WAASE,aAAT,GAAyB;EACvB,UAAMC,UAAU,GAAGvB,IAAI,CAACd,KAAL,CAAWiB,YAAX,CAAnB;;EACA,QAAIoB,UAAJ,EAAgB;EACd,YAAMrC,KAAK,GAAG;EACZsC,QAAAA,OAAO,EAAED,UAAU,CAAC,CAAD,CADP;EAEZ5D,QAAAA,KAAK,EAAE;EAFK,OAAd;EAIAwD,MAAAA,OAAO,CAACI,UAAU,CAAC,CAAD,CAAV,CAAczD,MAAf,CAAP,CALc;;EAOd,UAAIgD,GAAJ,EAAS/C,IAAT;;EACA,aACE,EAAE+C,GAAG,GAAGd,IAAI,CAACd,KAAL,CAAWqB,aAAX,CAAR,MACCxC,IAAI,GAAGiC,IAAI,CAACd,KAAL,CAAWoB,SAAX,CADR,CADF,EAGE;EACApB,QAAAA,KAAK,CAACvB,KAAN,CAAY0B,IAAZ,CAAiB;EACfrB,UAAAA,IAAI,EAAED,IAAI,CAAC,CAAD,CADK;EAEfG,UAAAA,KAAK,EAAEH,IAAI,CAAC,CAAD,CAAJ,IAAWA,IAAI,CAAC,CAAD,CAAf,IAAsBA,IAAI,CAAC,CAAD;EAFlB,SAAjB;EAIAoD,QAAAA,OAAO,CAACpD,IAAI,CAAC,CAAD,CAAJ,CAAQD,MAAT,CAAP;EACD;;EACD,UAAIgD,GAAJ,EAAS;EACPK,QAAAA,OAAO,CAACL,GAAG,CAAC,CAAD,CAAH,CAAOhD,MAAR,CAAP;EACD;;EACD,aAAOoB,KAAP;EACD;;EACD,WAAO,KAAP;EACD,GArF6B;;;EAwF9B,SAAOc,IAAP,EAAa;EACX;EACA,QAAIZ,KAAK,GAAGY,IAAI,CAACyB,OAAL,CAAa,GAAb,CAAZ;;EACA,QAAIrC,KAAK,KAAK,CAAd,EAAiB;EACf;EACA,YAAMsC,aAAa,GAAGJ,aAAa,EAAnC;;EAEA,UAAII,aAAJ,EAAmB;EACjB;EACAd,QAAAA,KAAK,CAACc,aAAa,CAACF,OAAf,EAAwBE,aAAa,CAAC/D,KAAtC,CAAL;EACA;EACD;;EACD,UAAIgE,WAAJ;;EACA,UAAKA,WAAW,GAAG3B,IAAI,CAACd,KAAL,CAAWmB,MAAX,CAAnB,EAAwC;EACtC;EACAS,QAAAA,GAAG,CAACa,WAAW,CAAC,CAAD,CAAZ,CAAH;EACAR,QAAAA,OAAO,CAACQ,WAAW,CAAC,CAAD,CAAX,CAAe7D,MAAhB,CAAP;EACA;EACD;;EAED;EACD,KArBU;;;EAuBX,QAAIsB,KAAK,GAAG,CAAZ,EAAe;EACb,UAAI8B,KAAK,GAAGlB,IAAI,CAACqB,SAAL,CAAe,CAAf,EAAkBjC,KAAlB,CAAZ;EACAN,MAAAA,IAAI,CAACoC,KAAD,CAAJ;EACAC,MAAAA,OAAO,CAACD,KAAK,CAACpD,MAAP,CAAP;EACD;EACF;;EACD,SAAO2C,IAAP;EACD;;ECnHM,SAASmB,iBAAT,CAA2BC,QAA3B,EAAqC;EAC1C;EACA,QAAMlC,GAAG,GAAGI,SAAS,CAAC8B,QAAD,CAArB,CAF0C;EAI1C;EACA;;EACA,QAAMjC,IAAI,GAAGf,QAAQ,CAACc,GAAD,CAArB,CAN0C;;EAQ1C,QAAMmC,MAAM,GAAG,IAAIC,QAAJ,CAAc,qBAAoBnC,IAAK,GAAvC,CAAf;EACA,SAAOkC,MAAP;EACD;;ECbM,SAASE,UAAT,CAAoBC,IAApB,EAA0B;EAC/B,SAAO,OAAOA,IAAP,KAAgB,UAAvB;EACD;EAEM,SAASC,QAAT,CAAkBC,GAAlB,EAAuB;EAC5B,SAAO,OAAOA,GAAP,KAAe,QAAf,IAA2BA,GAAG,KAAK,IAA1C;EACD;EAEM,SAASC,OAAT,CAAiBD,GAAjB,EAAsB;EAC3B,SAAOE,KAAK,CAACD,OAAN,CAAcD,GAAd,CAAP;EACD;EAED,IAAIG,SAAS,GAAG,EAAhB;EACA,IAAIC,OAAO,GAAG,KAAd;;EAEA,SAASC,cAAT,GAA0B;EACxBF,EAAAA,SAAS,CAACG,OAAV,CAAmBC,EAAD,IAAQA,EAAE,EAA5B;EACAJ,EAAAA,SAAS,GAAG,EAAZ;EACAC,EAAAA,OAAO,GAAG,KAAV;EACD;;EAEM,SAASI,QAAT,CAAkBD,EAAlB,EAAsB;EAC3B;EACAJ,EAAAA,SAAS,CAACjD,IAAV,CAAeqD,EAAf;;EACA,MAAI,CAACH,OAAL,EAAc;EACZK,IAAAA,OAAO,CAACC,OAAR,GAAkBC,IAAlB,CAAuBN,cAAvB;EACAD,IAAAA,OAAO,GAAG,IAAV;EACD;EACF;EAGD;EACA;;EACA,MAAMQ,MAAM,GAAG,EAAf;EACA,MAAMC,SAAS,GAAG,CAAC,cAAD,EAAiB,SAAjB,EAA4B,aAA5B,EAA2C,SAA3C,CAAlB;EACAA,SAAS,CAACP,OAAV,CAAmBQ,IAAD,IAAU;EAC1BF,EAAAA,MAAM,CAACE,IAAD,CAAN,GAAe,UAAUC,SAAV,EAAqBC,QAArB,EAA+B;EAC5C,QAAIA,QAAJ,EAAc;EACZ,UAAID,SAAJ,EAAe;EACb;EACA,eAAOA,SAAS,CAACE,MAAV,CAAiBD,QAAjB,CAAP;EACD,OAHD,MAGO;EACL,YAAIf,OAAO,CAACe,QAAD,CAAX,EAAuB;EACrB,iBAAOA,QAAP;EACD,SAFD,MAEO;EACL,iBAAO,CAACA,QAAD,CAAP;EACD;EACF;EACF,KAXD,MAWO;EACL,aAAOD,SAAP;EACD;EACF,GAfD;EAgBD,CAjBD;EAmBO,SAASG,YAAT,CAAsBH,SAAtB,EAAiCC,QAAjC,EAA2C;EAChD,MAAIG,OAAO,GAAG,EAAd;;EACA,OAAK,MAAMC,GAAX,IAAkBL,SAAlB,EAA6B;EAC3BM,IAAAA,UAAU,CAACD,GAAD,CAAV;EACD;;EAED,OAAK,MAAMA,GAAX,IAAkBJ,QAAlB,EAA4B;EAC1B,QAAI,CAACD,SAAS,CAACO,cAAV,CAAyBF,GAAzB,CAAL,EAAoC;EAClCC,MAAAA,UAAU,CAACD,GAAD,CAAV;EACD;EACF;;EACD,WAASC,UAAT,CAAoBD,GAApB,EAAyB;EACvB;EACA,UAAMG,KAAK,GAAGX,MAAM,CAACQ,GAAD,CAApB;;EACA,QAAIG,KAAJ,EAAW;EACTJ,MAAAA,OAAO,CAACC,GAAD,CAAP,GAAeG,KAAK,CAACR,SAAS,CAACK,GAAD,CAAV,EAAiBJ,QAAQ,CAACI,GAAD,CAAzB,CAApB;EACD,KAFD,MAEO;EACLD,MAAAA,OAAO,CAACC,GAAD,CAAP,GAAeJ,QAAQ,CAACI,GAAD,CAAR,IAAiBL,SAAS,CAACK,GAAD,CAAzC;EACD;EACF;;EACD,SAAOD,OAAP;EACD;;ECzEM,SAASK,aAAT,CAAuBC,GAAvB,EAA4B;EACjC;EACAA,EAAAA,GAAG,CAACN,OAAJ,GAAc,EAAd;;EAEAM,EAAAA,GAAG,CAACC,KAAJ,GAAY,UAAUP,OAAV,EAAmB;EAC7B,SAAKA,OAAL,GAAeD,YAAY,CAAC,KAAKC,OAAN,EAAeA,OAAf,CAA3B;EACA,WAAO,IAAP;EACD,GAHD;;EAIAM,EAAAA,GAAG,CAACE,SAAJ,GAAgB,UAAUR,OAAV,EAAmB,EAAnC;;EACAM,EAAAA,GAAG,CAACG,MAAJ,GAAa,UAAUT,OAAV,EAAmB,EAAhC;;EACAM,EAAAA,GAAG,CAACI,SAAJ,GAAgB,UAAUV,OAAV,EAAmB,EAAnC;EACD;;ECbD,IAAIW,IAAE,GAAG,CAAT;;EAEA,MAAMC,GAAN,CAAU;EACR;EACAC,EAAAA,WAAW,GAAG;EACZ,SAAKC,IAAL,GAAY,EAAZ;EACA,SAAKH,EAAL,GAAUA,IAAE,EAAZ;EACD;;EACDI,EAAAA,MAAM,GAAG;EACP;EACA;EACAH,IAAAA,GAAG,CAACI,MAAJ,CAAWC,MAAX,CAAkB,IAAlB;EACD;;EACDC,EAAAA,MAAM,CAACC,OAAD,EAAU;EACd;EACA,SAAKL,IAAL,CAAU/E,IAAV,CAAeoF,OAAf;EACD;;EACDC,EAAAA,MAAM,GAAG;EACP,SAAKN,IAAL,CAAU3B,OAAV,CAAmBkC,CAAD,IAAOA,CAAC,CAACC,MAAF,EAAzB;EACD;;EAjBO;;;EAqBVV,GAAG,CAACI,MAAJ,GAAa,IAAb;;ECpBA,IAAIO,KAAK,GAAG,EAAZ;;EAEA,IAAIC,GAAG,GAAG,EAAV;EAEA,IAAIC,OAAO,GAAG,KAAd;;EAEA,SAASC,mBAAT,GAA+B;EAC7BH,EAAAA,KAAK,CAACpC,OAAN,CAAegC,OAAD,IAAaA,OAAO,CAACQ,GAAR,EAA3B;EACAJ,EAAAA,KAAK,GAAG,EAAR;EACAC,EAAAA,GAAG,GAAG,EAAN;EACAC,EAAAA,OAAO,GAAG,KAAV;EACD;;EAEM,SAASG,YAAT,CAAsBT,OAAtB,EAA+B;EACpC,QAAMR,EAAE,GAAGQ,OAAO,CAACR,EAAnB;;EACA,MAAI,CAACa,GAAG,CAACb,EAAD,CAAR,EAAc;EACZa,IAAAA,GAAG,CAACb,EAAD,CAAH,GAAU,IAAV;EACAY,IAAAA,KAAK,CAACxF,IAAN,CAAWoF,OAAX;;EAEA,QAAI,CAACM,OAAL,EAAc;EACZpC,MAAAA,QAAQ,CAACqC,mBAAD,CAAR;EACAD,MAAAA,OAAO,GAAG,IAAV;EACD;EACF;EACF;;ECzBD,IAAId,EAAE,GAAG,CAAT;;EACA,MAAMkB,OAAN,CAAc;EACZ;EACAhB,EAAAA,WAAW,CAACiB,EAAD,EAAK1C,EAAL,EAAS2C,EAAT,EAAa/B,OAAb,EAAsB;EAC/B,SAAK8B,EAAL,GAAUA,EAAV;EACA,SAAK1C,EAAL,GAAUA,EAAV;EACA,SAAK2C,EAAL,GAAUA,EAAV;EACA,SAAK/B,OAAL,GAAeA,OAAf;EAEA,SAAKW,EAAL,GAAUA,EAAE,EAAZ;EAEA,SAAKqB,MAAL,GAAc,IAAIC,GAAJ,EAAd;EACA,SAAKC,IAAL,GAAY,EAAZ,CAT+B;;EAW/B,SAAKC,OAAL,GAAe/C,EAAf,CAX+B;;EAa/B,SAAKgD,GAAL;EACD;;EACDA,EAAAA,GAAG,GAAG;EACJ;EACAxB,IAAAA,GAAG,CAACI,MAAJ,GAAa,IAAb,CAFI;;EAIJ,SAAKmB,OAAL;EACAvB,IAAAA,GAAG,CAACI,MAAJ,GAAa,IAAb;EACD;;EACDC,EAAAA,MAAM,CAACoB,GAAD,EAAM;EACV,UAAMC,GAAG,GAAGD,GAAG,CAAC1B,EAAhB;;EAEA,QAAI,CAAC,KAAKqB,MAAL,CAAYR,GAAZ,CAAgBc,GAAhB,CAAL,EAA2B;EACzB,WAAKN,MAAL,CAAYO,GAAZ,CAAgBD,GAAhB;EACA,WAAKJ,IAAL,CAAUnG,IAAV,CAAesG,GAAf;EAEAA,MAAAA,GAAG,CAACnB,MAAJ,CAAW,IAAX;EACD;EACF;;EACDI,EAAAA,MAAM,GAAG;EACP;EACA;EACAM,IAAAA,YAAY,CAAC,IAAD,CAAZ,CAHO;EAKR;;EACDD,EAAAA,GAAG,GAAG;EACJ,SAAKS,GAAL;EACD;;EA1CW;;ECHd;EACO,SAASI,aAAT,CAAuBV,EAAvB,EAA2BvF,GAA3B,EAAgCoC,IAAI,GAAG,EAAvC,EAA2C,GAAGzC,QAA9C,EAAwD;EAC7D,SAAOuG,KAAK,CAACX,EAAD,EAAKvF,GAAL,EAAUoC,IAAV,EAAgBzC,QAAhB,EAA0ByC,IAAI,CAACsB,GAA/B,EAAoCzD,SAApC,CAAZ;EACD;EACM,SAASkG,UAAT,CAAoBZ,EAApB,EAAwBtG,IAAxB,EAA8B;EACnC,SAAOiH,KAAK,CAACX,EAAD,EAAKtF,SAAL,EAAgBA,SAAhB,EAA2BA,SAA3B,EAAsCA,SAAtC,EAAiDhB,IAAjD,CAAZ;EACD;EAED;;EACO,SAASmH,WAAT,CAAqBC,QAArB,EAA+BC,QAA/B,EAAyC;EAC9C,SAAOD,QAAQ,CAACrG,GAAT,KAAiBsG,QAAQ,CAACtG,GAA1B,IAAiCqG,QAAQ,CAAC3C,GAAT,KAAiB4C,QAAQ,CAAC5C,GAAlE;EACD;;EAED,SAASwC,KAAT,CAAeX,EAAf,EAAmBvF,GAAnB,EAAwBoC,IAAxB,EAA8BzC,QAA9B,EAAwC+D,GAAxC,EAA6CzE,IAA7C,EAAmD;EACjD,SAAO;EACLsG,IAAAA,EADK;EAELvF,IAAAA,GAFK;EAGLoC,IAAAA,IAHK;EAILzC,IAAAA,QAJK;EAKL+D,IAAAA,GALK;EAMLzE,IAAAA;EANK,GAAP;EAQD;;ECpBM,SAASsH,KAAT,CAAeD,QAAf,EAAyBE,KAAzB,EAAgC;EACrC,QAAMC,aAAa,GAAGH,QAAQ,CAACI,QAA/B;;EACA,MAAID,aAAJ,EAAmB;EACjB;EACA,UAAME,GAAG,GAAGC,SAAS,CAACJ,KAAD,CAArB;EACA,UAAMK,UAAU,GAAGP,QAAQ,CAACO,UAA5B;EACAA,IAAAA,UAAU,CAACC,YAAX,CAAwBH,GAAxB,EAA6BL,QAAQ,CAACS,WAAtC;EACAF,IAAAA,UAAU,CAACG,WAAX,CAAuBV,QAAvB,EALiB;;EAOjB,WAAOK,GAAP;EACD,GARD,MAQO;EACL;EACA;EACA,QAAI,CAACP,WAAW,CAACE,QAAD,EAAWE,KAAX,CAAhB,EAAmC;EACjC,aAAOF,QAAQ,CAACzH,EAAT,CAAYgI,UAAZ,CAAuBI,YAAvB,CAAoCL,SAAS,CAACJ,KAAD,CAA7C,EAAsDF,QAAQ,CAACzH,EAA/D,CAAP;EACD,KALI;;;EAOL,UAAMA,EAAE,GAAI2H,KAAK,CAAC3H,EAAN,GAAWyH,QAAQ,CAACzH,EAAhC;;EACA,QAAI,CAACyH,QAAQ,CAACtG,GAAd,EAAmB;EACjB;EACA,UAAIsG,QAAQ,CAACrH,IAAT,KAAkBuH,KAAK,CAACvH,IAA5B,EAAkC;EAChC,eAAQJ,EAAE,CAACqI,WAAH,GAAiBV,KAAK,CAACvH,IAA/B;EACD;EACF,KAbI;;;EAeLkI,IAAAA,gBAAgB,CAACX,KAAD,EAAQF,QAAQ,CAAClE,IAAjB,CAAhB,CAfK;EAkBL;;EACA,UAAMgF,WAAW,GAAGd,QAAQ,CAAC3G,QAAT,IAAqB,EAAzC;EACA,UAAM0H,WAAW,GAAGb,KAAK,CAAC7G,QAAN,IAAkB,EAAtC,CApBK;;EAsBL,QAAIyH,WAAW,CAACnJ,MAAZ,GAAqB,CAArB,IAA0BoJ,WAAW,CAACpJ,MAAZ,KAAuB,CAArD,EAAwD;EACtDY,MAAAA,EAAE,CAACyI,SAAH,GAAe,EAAf;EACD,KAFD,MAEO,IAAID,WAAW,CAACpJ,MAAZ,GAAqB,CAArB,IAA0BmJ,WAAW,CAACnJ,MAAZ,KAAuB,CAArD,EAAwD;EAC7D;EACAoJ,MAAAA,WAAW,CAACzE,OAAZ,CAAqB2E,KAAD,IAAW1I,EAAE,CAAC2I,WAAH,CAAeZ,SAAS,CAACW,KAAD,CAAxB,CAA/B;EACD,KAHM,MAGA;EACL;EACAE,MAAAA,cAAc,CAAC5I,EAAD,EAAKuI,WAAL,EAAkBC,WAAlB,CAAd;EACD;EACF;EACF;;EAEM,SAAST,SAAT,CAAmBJ,KAAnB,EAA0B;EAC/B,QAAM;EAAExG,IAAAA,GAAF;EAAOoC,IAAAA,IAAP;EAAazC,IAAAA,QAAb;EAAuBV,IAAAA,IAAvB;EAA6BsG,IAAAA;EAA7B,MAAoCiB,KAA1C,CAD+B;;EAG/B,MAAI,OAAOxG,GAAP,KAAe,QAAnB,EAA6B;EAC3BwG,IAAAA,KAAK,CAAC3H,EAAN,GAAW6I,QAAQ,CAACzB,aAAT,CAAuBjG,GAAvB,CAAX;EACAmH,IAAAA,gBAAgB,CAACX,KAAD,CAAhB;EACA7G,IAAAA,QAAQ,CAACiD,OAAT,CAAkB2E,KAAD,IAAW;EAC1Bf,MAAAA,KAAK,CAAC3H,EAAN,CAAS2I,WAAT,CAAqBZ,SAAS,CAACW,KAAD,CAA9B;EACD,KAFD;EAGD,GAND,MAMO;EACL;EACAf,IAAAA,KAAK,CAAC3H,EAAN,GAAW6I,QAAQ,CAACC,cAAT,CAAwB1I,IAAxB,CAAX;EACD;;EACD,SAAOuH,KAAK,CAAC3H,EAAb;EACD;;EAED,SAASsI,gBAAT,CAA0BX,KAA1B,EAAiCoB,QAAQ,GAAG,EAA5C,EAAgD;EAC9C;EACA;EACA,QAAM/I,EAAE,GAAG2H,KAAK,CAAC3H,EAAjB;EACA,QAAMgJ,QAAQ,GAAGrB,KAAK,CAACpE,IAAN,IAAc,EAA/B;EACA,QAAM0F,QAAQ,GAAGD,QAAQ,CAACE,KAAT,IAAkB,EAAnC;EACA,QAAMC,QAAQ,GAAGJ,QAAQ,CAACG,KAAT,IAAkB,EAAnC;;EACA,OAAK,MAAMrE,GAAX,IAAkBsE,QAAlB,EAA4B;EAC1B;EACA,QAAI,CAACF,QAAQ,CAACpE,GAAD,CAAb,EAAoB;EAClB7E,MAAAA,EAAE,CAACkJ,KAAH,CAASrE,GAAT,IAAgB,EAAhB;EACD;EACF,GAZ6C;;;EAc9C,OAAK,MAAMA,GAAX,IAAkBmE,QAAlB,EAA4B;EAC1B;EACA,QAAInE,GAAG,KAAK,OAAZ,EAAqB;EACnB,WAAK,MAAMA,GAAX,IAAkBoE,QAAlB,EAA4B;EAC1B;EACAjJ,QAAAA,EAAE,CAACkJ,KAAH,CAASrE,GAAT,IAAgBoE,QAAQ,CAACpE,GAAD,CAAxB;EACD;EACF,KALD,MAKO;EACL7E,MAAAA,EAAE,CAACoJ,YAAH,CAAgBvE,GAAhB,EAAqBmE,QAAQ,CAACnE,GAAD,CAA7B;EACD;EACF;;EACD,OAAK,MAAMA,GAAX,IAAkBkE,QAAlB,EAA4B;EAC1B,QAAI,CAACC,QAAQ,CAACnE,GAAD,CAAb,EAAoB;EAClB7E,MAAAA,EAAE,CAACqJ,eAAH,CAAmBxE,GAAnB;EACD;EACF;EACF;;;EAGD,SAAS+D,cAAT,CAAwB5I,EAAxB,EAA4BuI,WAA5B,EAAyCC,WAAzC,EAAsD;EACpD;EACA;EACA,MAAIc,aAAa,GAAG,CAApB;EACA,MAAIC,aAAa,GAAGhB,WAAW,CAAC,CAAD,CAA/B;EACA,MAAIiB,WAAW,GAAGjB,WAAW,CAACnJ,MAAZ,GAAqB,CAAvC;EACA,MAAIqK,WAAW,GAAGlB,WAAW,CAACiB,WAAD,CAA7B;EAEA,MAAIE,aAAa,GAAG,CAApB;EACA,MAAIC,aAAa,GAAGnB,WAAW,CAAC,CAAD,CAA/B;EACA,MAAIoB,WAAW,GAAGpB,WAAW,CAACpJ,MAAZ,GAAqB,CAAvC;EACA,MAAIyK,WAAW,GAAGrB,WAAW,CAACoB,WAAD,CAA7B;;EAEA,WAASE,cAAT,CAAwBhJ,QAAxB,EAAkC;EAChC,UAAMC,GAAG,GAAG,EAAZ;EACAD,IAAAA,QAAQ,CAACiD,OAAT,CAAiB,CAAC/C,IAAD,EAAON,KAAP,KAAiB;EAChCK,MAAAA,GAAG,CAACC,IAAI,CAAC6D,GAAN,CAAH,GAAgBnE,KAAhB;EACD,KAFD;EAGA,WAAOK,GAAP;EACD;;EACD,QAAMgJ,OAAO,GAAGD,cAAc,CAACvB,WAAD,CAA9B,CApBoD;;EAuBpD,SAAOe,aAAa,IAAIE,WAAjB,IAAgCE,aAAa,IAAIE,WAAxD,EAAqE;EACnE;EACA,QAAI,CAACL,aAAL,EAAoB;EAClBA,MAAAA,aAAa,GAAGhB,WAAW,CAAC,EAAEe,aAAH,CAA3B;EACD,KAFD,MAEO,IAAI,CAACG,WAAL,EAAkB;EACvBA,MAAAA,WAAW,GAAGlB,WAAW,CAAC,EAAEiB,WAAH,CAAzB;EACD,KAFM,MAEA,IAAIjC,WAAW,CAACgC,aAAD,EAAgBI,aAAhB,CAAf,EAA+C;EACpD;EACAjC,MAAAA,KAAK,CAAC6B,aAAD,EAAgBI,aAAhB,CAAL;EACAJ,MAAAA,aAAa,GAAGhB,WAAW,CAAC,EAAEe,aAAH,CAA3B;EACAK,MAAAA,aAAa,GAAGnB,WAAW,CAAC,EAAEkB,aAAH,CAA3B;EACD,KALM,MAKA,IAAInC,WAAW,CAACkC,WAAD,EAAcI,WAAd,CAAf,EAA2C;EAChDnC,MAAAA,KAAK,CAAC+B,WAAD,EAAcI,WAAd,CAAL;EACAJ,MAAAA,WAAW,GAAGlB,WAAW,CAAC,EAAEiB,WAAH,CAAzB;EACAK,MAAAA,WAAW,GAAGrB,WAAW,CAAC,EAAEoB,WAAH,CAAzB;EACD,KAJM,MAIA,IAAIrC,WAAW,CAACgC,aAAD,EAAgBM,WAAhB,CAAf,EAA6C;EAClDnC,MAAAA,KAAK,CAAC6B,aAAD,EAAgBM,WAAhB,CAAL;EAEA7J,MAAAA,EAAE,CAACiI,YAAH,CAAgBsB,aAAa,CAACvJ,EAA9B,EAAkCyJ,WAAW,CAACzJ,EAAZ,CAAekI,WAAjD;EAEAqB,MAAAA,aAAa,GAAGhB,WAAW,CAAC,EAAEe,aAAH,CAA3B;EACAO,MAAAA,WAAW,GAAGrB,WAAW,CAAC,EAAEoB,WAAH,CAAzB;EACD,KAPM,MAOA,IAAIrC,WAAW,CAACkC,WAAD,EAAcE,aAAd,CAAf,EAA6C;EAClDjC,MAAAA,KAAK,CAAC+B,WAAD,EAAcE,aAAd,CAAL;EACA3J,MAAAA,EAAE,CAACiI,YAAH,CAAgBwB,WAAW,CAACzJ,EAA5B,EAAgCuJ,aAAa,CAACvJ,EAA9C;EACAyJ,MAAAA,WAAW,GAAGlB,WAAW,CAAC,EAAEiB,WAAH,CAAzB;EACAG,MAAAA,aAAa,GAAGnB,WAAW,CAAC,EAAEkB,aAAH,CAA3B;EACD,KALM,MAKA;EACL;EACA,UAAIM,SAAS,GAAGD,OAAO,CAACJ,aAAa,CAAC9E,GAAf,CAAvB;;EACA,UAAI,CAACmF,SAAL,EAAgB;EACd;EACAhK,QAAAA,EAAE,CAACiI,YAAH,CAAgBF,SAAS,CAAC4B,aAAD,CAAzB,EAA0CJ,aAAa,CAACvJ,EAAxD;EACD,OAHD,MAGO;EACL;EACA,cAAMiK,SAAS,GAAG1B,WAAW,CAACyB,SAAD,CAA7B;EACAhK,QAAAA,EAAE,CAACiI,YAAH,CAAgBgC,SAAS,CAACjK,EAA1B,EAA8BuJ,aAAa,CAACvJ,EAA5C;EACA0H,QAAAA,KAAK,CAACuC,SAAD,EAAYN,aAAZ,CAAL,CAJK;;EAMLpB,QAAAA,WAAW,CAACyB,SAAD,CAAX,GAAyB,IAAzB;EACD;;EACDL,MAAAA,aAAa,GAAGnB,WAAW,CAAC,EAAEkB,aAAH,CAA3B;EACD;EACF;;EACD,MAAIA,aAAa,IAAIE,WAArB,EAAkC;EAChC,UAAMM,MAAM,GACV1B,WAAW,CAACoB,WAAW,GAAG,CAAf,CAAX,IAAgC,IAAhC,GACI,IADJ,GAEIpB,WAAW,CAACoB,WAAW,GAAG,CAAf,CAAX,CAA6B5J,EAHnC;;EAIA,SAAK,IAAIb,CAAC,GAAGuK,aAAb,EAA4BvK,CAAC,IAAIyK,WAAjC,EAA8CzK,CAAC,EAA/C,EAAmD;EACjD;EACA;EACA;EACA;EACAa,MAAAA,EAAE,CAACiI,YAAH,CAAgBF,SAAS,CAACS,WAAW,CAACrJ,CAAD,CAAZ,CAAzB,EAA2C+K,MAA3C;EACD;EACF;;EACD,MAAIZ,aAAa,IAAIE,WAArB,EAAkC;EAChC,SAAK,IAAIrK,CAAC,GAAGmK,aAAb,EAA4BnK,CAAC,IAAIqK,WAAjC,EAA8CrK,CAAC,EAA/C,EAAmD;EACjD;EACA,YAAMuJ,KAAK,GAAGH,WAAW,CAACpJ,CAAD,CAAzB,CAFiD;;EAIjDuJ,MAAAA,KAAK,IAAI1I,EAAE,CAACmI,WAAH,CAAeO,KAAK,CAAC1I,EAArB,CAAT;EACD;EACF;EACF;;ECpLM,SAASmK,cAAT,CAAwBzD,EAAxB,EAA4B;EACjC,QAAM0D,eAAe,GAAG,MAAM;EAC5B1D,IAAAA,EAAE,CAAC2D,OAAH,CAAW3D,EAAE,CAAC4D,OAAH,EAAX;EACD,GAFD;;EAGAC,EAAAA,QAAQ,CAAC7D,EAAD,EAAK,cAAL,CAAR,CAJiC;;EAMjC,MAAID,OAAJ,CACEC,EADF,EAEE0D,eAFF,EAGE,MAAM;EACJ9H,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;EACAgI,IAAAA,QAAQ,CAAC7D,EAAD,EAAK,SAAL,CAAR;EACD,GANH,EAOE,IAPF;EAUA6D,EAAAA,QAAQ,CAAC7D,EAAD,EAAK,SAAL,CAAR;EACD;EAEM,SAAS8D,cAAT,CAAwBC,GAAxB,EAA6B;EAClCA,EAAAA,GAAG,CAACC,SAAJ,CAAcL,OAAd,GAAwB,UAAUhD,KAAV,EAAiB;EACvC;EACA,UAAMX,EAAE,GAAG,IAAX,CAFuC;EAIvC;;EACAA,IAAAA,EAAE,CAACiE,GAAH,GAASjD,KAAK,CAAChB,EAAE,CAACiE,GAAJ,EAAStD,KAAT,CAAd;EACD,GAND;EAOD;EAEM,SAASkD,QAAT,CAAkB7D,EAAlB,EAAsBnC,IAAtB,EAA4B;EACjC,QAAMqG,QAAQ,GAAGlE,EAAE,CAACmE,QAAH,CAAYtG,IAAZ,CAAjB;;EACA,MAAIqG,QAAJ,EAAc;EACZA,IAAAA,QAAQ,CAAC7G,OAAT,CAAkBC,EAAD,IAAQ;EACvB;EACAA,MAAAA,EAAE,CAAC8G,IAAH,CAAQpE,EAAR;EACD,KAHD;EAID;EACF;;ECxCD;EACA,MAAMqE,iBAAiB,GAAGpH,KAAK,CAAC+G,SAAhC;;EAEO,MAAMM,YAAY,GAAGC,MAAM,CAACC,MAAP,CAAcH,iBAAd,CAArB;;EAEP,MAAMI,OAAO,GAAG,CAAC,MAAD,EAAS,KAAT,EAAgB,SAAhB,EAA2B,SAA3B,EAAsC,MAAtC,EAA8C,QAA9C,EAAwD,OAAxD,CAAhB;EAEAA,OAAO,CAACpH,OAAR,CAAiBqH,MAAD,IAAY;EAC1B;EACAJ,EAAAA,YAAY,CAACI,MAAD,CAAZ,GAAuB,UAAU,GAAGC,IAAb,EAAmB;EACxC;EACA;EACAN,IAAAA,iBAAiB,CAACK,MAAD,CAAjB,CAA0BN,IAA1B,CAA+B,IAA/B,EAAqC,GAAGO,IAAxC,EAHwC;;EAKxC,QAAIC,QAAQ,GAAG,IAAf;EACA,QAAIC,EAAE,GAAG,KAAKC,MAAd;;EACA,YAAQJ,MAAR;EACE;EACA,WAAK,QAAL;EACEE,QAAAA,QAAQ,GAAGD,IAAI,CAACvL,KAAL,CAAW,CAAX,CAAX,CADF;;EAEE;;EACF,WAAK,MAAL;EACA,WAAK,SAAL;EACE;EACAwL,QAAAA,QAAQ,GAAGD,IAAX;EACA;EATJ,KAPwC;;;EAmBxC,QAAIC,QAAJ,EAAc;EACZC,MAAAA,EAAE,CAACE,YAAH,CAAgBH,QAAhB;EACD;;EACDC,IAAAA,EAAE,CAACtE,GAAH,CAAOjB,MAAP;EACD,GAvBD;EAwBD,CA1BD;;ECHA,MAAM0F,QAAN,CAAe;EACbjG,EAAAA,WAAW,CAACjG,KAAD,EAAQ;EACjB;EACA;EACA;EACA,SAAKyH,GAAL,GAAW,IAAIzB,GAAJ,EAAX,CAJiB;EAKjB;;EACAyF,IAAAA,MAAM,CAACU,cAAP,CAAsBnM,KAAtB,EAA6B,QAA7B,EAAuC;EACrCoM,MAAAA,UAAU,EAAE,KADyB;EAErCpM,MAAAA,KAAK,EAAE;EAF8B,KAAvC;;EAIA,QAAIkE,OAAO,CAAClE,KAAD,CAAX,EAAoB;EAClB;EACAA,MAAAA,KAAK,CAACqM,SAAN,GAAkBb,YAAlB;EACA,WAAKS,YAAL,CAAkBjM,KAAlB;EACD,KAJD,MAIO;EACL;EACA,WAAKsM,IAAL,CAAUtM,KAAV;EACD;EACF,GAnBY;;;EAqBbiM,EAAAA,YAAY,CAAClI,IAAD,EAAO;EACjB;EACAA,IAAAA,IAAI,CAACQ,OAAL,CAAc/C,IAAD,IAAU+K,OAAO,CAAC/K,IAAD,CAA9B;EACD;;EAED8K,EAAAA,IAAI,CAACvI,IAAD,EAAO;EACT0H,IAAAA,MAAM,CAACe,IAAP,CAAYzI,IAAZ,EAAkBQ,OAAlB,CAA2Bc,GAAD,IAAS;EACjC;EACAoH,MAAAA,cAAc,CAAC1I,IAAD,EAAOsB,GAAP,EAAYtB,IAAI,CAACsB,GAAD,CAAhB,CAAd;EACD,KAHD;EAID;;EA/BY;EAkCf;;;EACA,SAASqH,WAAT,CAAqB1M,KAArB,EAA4B;EAC1B,OAAK,IAAIL,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGK,KAAK,CAACJ,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;EACrC,UAAMgN,OAAO,GAAG3M,KAAK,CAACL,CAAD,CAArB;EACAgN,IAAAA,OAAO,CAACX,MAAR,IAAkBW,OAAO,CAACX,MAAR,CAAevE,GAAf,CAAmBtB,MAAnB,EAAlB;;EAEA,QAAIhC,KAAK,CAACD,OAAN,CAAcyI,OAAd,CAAJ,EAA4B;EAC1BD,MAAAA,WAAW,CAACC,OAAD,CAAX;EACD;EACF;EACF;EACD;EACA;EACA;EACA;EACA;EACA;EACA;;;EACA,SAASF,cAAT,CAAwBG,GAAxB,EAA6BvH,GAA7B,EAAkCrF,KAAlC,EAAyC;EACvC;EACA,MAAI6M,OAAO,GAAGN,OAAO,CAACvM,KAAD,CAArB,CAFuC;;EAKvC,QAAMyH,GAAG,GAAG,IAAIzB,GAAJ,EAAZ;EAEAyF,EAAAA,MAAM,CAACU,cAAP,CAAsBS,GAAtB,EAA2BvH,GAA3B,EAAgC;EAC9BmC,IAAAA,GAAG,GAAG;EACJ,UAAIxB,GAAG,CAACI,MAAR,EAAgB;EACd;EACAqB,QAAAA,GAAG,CAACtB,MAAJ,GAFc;EAKd;EACA;;EACA,YAAI0G,OAAJ,EAAa;EACXA,UAAAA,OAAO,CAACpF,GAAR,CAAYtB,MAAZ;;EACA,cAAIhC,KAAK,CAACD,OAAN,CAAclE,KAAd,CAAJ,EAA0B;EACxB;EACA0M,YAAAA,WAAW,CAAC1M,KAAD,CAAX;EACD;EACF;EACF,OAfG;EAkBJ;;;EACA,aAAOA,KAAP;EACD,KArB6B;;EAsB9B8M,IAAAA,GAAG,CAACC,MAAD,EAAS;EACV,UAAI/M,KAAK,KAAK+M,MAAd,EAAsB;EACpB;EACAR,QAAAA,OAAO,CAACQ,MAAD,CAAP;EACA/M,QAAAA,KAAK,GAAG+M,MAAR,CAHoB;;EAKpBtF,QAAAA,GAAG,CAACjB,MAAJ;EACD;EACF;;EA9B6B,GAAhC;EAgCD;;EAEM,SAAS+F,OAAT,CAAiBvM,KAAjB,EAAwB;EAC7B;EACA,MAAI,CAACgE,QAAQ,CAAChE,KAAD,CAAb,EAAsB;EACpB;EACD,GAJ4B;;;EAO7B,MAAIA,KAAK,CAACgM,MAAV,EAAkB;EAChB;EACD,GAT4B;EAY7B;EACA;;;EACA,SAAO,IAAIE,QAAJ,CAAalM,KAAb,CAAP;EACD;;EC7GM,SAASgN,SAAT,CAAmB9F,EAAnB,EAAuB;EAC5B,QAAM+F,IAAI,GAAG/F,EAAE,CAACmE,QAAhB;;EACA,MAAI4B,IAAI,CAAClJ,IAAT,EAAe;EACbmJ,IAAAA,QAAQ,CAAChG,EAAD,CAAR;EACD;EACF;;EAED,SAASgG,QAAT,CAAkBhG,EAAlB,EAAsB;EACpB;EACA,MAAInD,IAAI,GAAGmD,EAAE,CAACmE,QAAH,CAAYtH,IAAvB,CAFoB;EAIpB;EACA;;EACAmD,EAAAA,EAAE,CAACiG,KAAH,GAAWpJ,IAAI,GAAGD,UAAU,CAACC,IAAD,CAAV,GAAmBA,IAAI,CAACuH,IAAL,CAAUpE,EAAV,CAAnB,GAAmCnD,IAArD;EAEAwI,EAAAA,OAAO,CAACxI,IAAD,CAAP;;EAEA,OAAK,MAAMsB,GAAX,IAAkBtB,IAAlB,EAAwB;EACtBqJ,IAAAA,KAAK,CAAClG,EAAD,EAAK7B,GAAL,EAAU,OAAV,CAAL;EACD;EACF;EAED;;;EACA,SAAS+H,KAAT,CAAelG,EAAf,EAAmB7B,GAAnB,EAAwBgI,MAAxB,EAAgC;EAC9B5B,EAAAA,MAAM,CAACU,cAAP,CAAsBjF,EAAtB,EAA0B7B,GAA1B,EAA+B;EAC7BmC,IAAAA,GAAG,GAAG;EACJ,aAAON,EAAE,CAACmG,MAAD,CAAF,CAAWhI,GAAX,CAAP;EACD,KAH4B;;EAI7ByH,IAAAA,GAAG,CAACC,MAAD,EAAS;EACV7F,MAAAA,EAAE,CAACmG,MAAD,CAAF,CAAWhI,GAAX,IAAkB0H,MAAlB;EACD;;EAN4B,GAA/B;EAQD;;EC9BM,SAASO,SAAT,CAAmB5H,GAAnB,EAAwB;EAC7B;EACA;EACAA,EAAAA,GAAG,CAACwF,SAAJ,CAAcqC,KAAd,GAAsB,UAAUnI,OAAV,EAAmB;EACvC,UAAM8B,EAAE,GAAG,IAAX,CADuC;EAGvC;;EACAA,IAAAA,EAAE,CAACmE,QAAH,GAAclG,YAAY,CAAC+B,EAAE,CAACjB,WAAH,CAAeb,OAAhB,EAAyBA,OAAzB,CAA1B;EAEA4H,IAAAA,SAAS,CAAC9F,EAAD,CAAT;;EAEA,QAAIA,EAAE,CAACmE,QAAH,CAAY7K,EAAhB,EAAoB;EAClB;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA0G,MAAAA,EAAE,CAACsG,MAAH,CAAUtG,EAAE,CAACmE,QAAH,CAAY7K,EAAtB;EACD;EACF,GAnBD;;EAoBAkF,EAAAA,GAAG,CAACwF,SAAJ,CAAcsC,MAAd,GAAuB,UAAUhN,EAAV,EAAc;EACnC,UAAM0G,EAAE,GAAG,IAAX;EACA,UAAM+F,IAAI,GAAG/F,EAAE,CAACmE,QAAhB,CAFmC;;EAInC7K,IAAAA,EAAE,GAAG6I,QAAQ,CAACoE,aAAT,CAAuBjN,EAAvB,CAAL,CAJmC;;EAMnC0G,IAAAA,EAAE,CAACiE,GAAH,GAAS3K,EAAT;;EAEA,QAAI,CAACyM,IAAI,CAACrJ,MAAV,EAAkB;EAChB;EACA,UAAID,QAAQ,GAAGsJ,IAAI,CAACtJ,QAApB;;EACA,UAAI,CAACA,QAAL,EAAe;EACbA,QAAAA,QAAQ,GAAGnD,EAAE,CAACkN,SAAd;EACD;;EAED,UAAI9J,MAAM,GAAGF,iBAAiB,CAACC,QAAD,CAA9B;EACAsJ,MAAAA,IAAI,CAACrJ,MAAL,GAAcA,MAAd;EACD;;EACD+G,IAAAA,cAAc,CAACzD,EAAD,CAAd;EACD,GAnBD;;EAoBAxB,EAAAA,GAAG,CAACwF,SAAJ,CAAcyC,SAAd,GAA0BlJ,QAA1B;EACD;;EC9CM,SAASmJ,WAAT,CAAqBlI,GAArB,EAA0B;EAC/B;EACAA,EAAAA,GAAG,CAACwF,SAAJ,CAAc2C,EAAd,GAAmB,YAAY;EAC7B,UAAM3G,EAAE,GAAG,IAAX;EACA,WAAOU,aAAa,CAACV,EAAD,EAAK,GAAGhH,SAAR,CAApB;EACD,GAHD,CAF+B;;;EAO/BwF,EAAAA,GAAG,CAACwF,SAAJ,CAAc4C,EAAd,GAAmB,UAAUlN,IAAV,EAAgB;EACjC,UAAMsG,EAAE,GAAG,IAAX;EACA,WAAOY,UAAU,CAACZ,EAAD,EAAKtG,IAAL,CAAjB;EACD,GAHD,CAP+B;;;EAY/B8E,EAAAA,GAAG,CAACwF,SAAJ,CAAc6C,EAAd,GAAmB,UAAU9J,GAAV,EAAe;EAChC,QAAID,QAAQ,CAACC,GAAD,CAAZ,EAAmB;EACjB,aAAO7D,IAAI,CAACC,SAAL,CAAe4D,GAAf,CAAP;EACD;;EACD,WAAOA,GAAP;EACD,GALD;;EAMAyB,EAAAA,GAAG,CAACwF,SAAJ,CAAcJ,OAAd,GAAwB,YAAY;EAClC,UAAM5D,EAAE,GAAG,IAAX;EACA,UAAM;EAAEtD,MAAAA;EAAF,QAAasD,EAAE,CAACmE,QAAtB;EACA,UAAMxD,KAAK,GAAGjE,MAAM,CAAC0H,IAAP,CAAYpE,EAAZ,CAAd;EACA,WAAOW,KAAP;EACD,GALD;EAMD;;ECpBD;EACA;EACA;;EACA,SAASnC,GAAT,CAAaN,OAAb,EAAsB;EACpB;EACA,OAAKmI,KAAL,CAAWnI,OAAX;EACD;;EAEDkI,SAAS,CAAC5H,GAAD,CAAT;EACAkI,WAAW,CAAClI,GAAD,CAAX;EACAsF,cAAc,CAACtF,GAAD,CAAd;EACAD,aAAa,CAACC,GAAD,CAAb;;EAGA,MAAMsI,GAAG,GAAG,IAAItI,GAAJ,CAAQ;EAClB3B,EAAAA,IAAI,GAAG;EACL,WAAO;EACLjE,MAAAA,IAAI,EAAE;EADD,KAAP;EAGD;;EALiB,CAAR,CAAZ;EAOA,MAAMmO,OAAO,GAAGvK,iBAAiB,CAAE;AACnC;AACA;AACA;AACA;AACA,OALiC,CAAjC;EAMA,MAAMuE,QAAQ,GAAGgG,OAAO,CAAC3C,IAAR,CAAa0C,GAAb,CAAjB;EACA,MAAME,GAAG,GAAG3F,SAAS,CAACN,QAAD,CAArB;EACAoB,QAAQ,CAAC8E,IAAT,CAAchF,WAAd,CAA0B+E,GAA1B;;EAEA,MAAME,GAAG,GAAG,IAAI1I,GAAJ,CAAQ;EAClB3B,EAAAA,IAAI,GAAG;EACL,WAAO;EACLjE,MAAAA,IAAI,EAAE;EADD,KAAP;EAGD;;EALiB,CAAR,CAAZ;EAOA,MAAMuO,OAAO,GAAG3K,iBAAiB,CAAE;AACnC;AACA;AACA;AACA;AACA;AACA,OANiC,CAAjC;EAOA,MAAMsE,QAAQ,GAAGqG,OAAO,CAAC/C,IAAR,CAAa8C,GAAb,CAAjB;EACAE,UAAU,CAAC,MAAM;EACfpG,EAAAA,KAAK,CAACD,QAAD,EAAWD,QAAX,CAAL;EACD,CAFS,EAEP,IAFO,CAAV;;;;;;;;"}